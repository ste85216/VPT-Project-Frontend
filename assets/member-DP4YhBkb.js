import{_ as de,i as me,r as i,o as N,b as pe,d as t,w as s,C as Y,F as ce,D as j,J as v,g as u,ay as O,aL as p,aM as ve,e as o,aN as ge,s as G,y as Q,t as fe,B as W,q as X,z as Z,aO as _,p as be,k as ye,h as Ve}from"./index-CF1RYFcj.js";import{v as B}from"./index-DcBOdE6S.js";import{c as ke,a as d,u as he,b as g}from"./vee-validate.esm-Dpcw_Ra9.js";import{b as ee}from"./route-block-B_A1xBdJ.js";import{V as xe}from"./VContainer-BkOz3W2q.js";import{V as we,a as z}from"./VRow-wgoWGFgv.js";import{V as Ce}from"./VDataTableServer-psgnHN2Y.js";import{V as Se}from"./VForm-DqOlPtGc.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-D56GwoCt.js";import"./VPagination-ChZV2KPN.js";import"./VSelect-Cqr_1MRr.js";import"./VList-28rShKfM.js";import"./VDivider-DeOI2aEs.js";import"./VCheckboxBtn-Bjto8ame.js";import"./VChip-B52kgBEx.js";import"./filter-BIDoOIeT.js";const Pe=y=>(be("data-v-55140673"),y=y(),ye(),y),$e=Pe(()=>Ve("h2",{class:"text-center"}," 會員管理 ",-1)),ae={__name:"member",setup(y){const{apiAuth:q}=j(),{api:le}=j(),b=me(),V=i(!1),k=i(!1),r=i({open:!1,id:""}),h=i({open:!1}),K=l=>{l?(k.value=!0,r.value.id=l._id,x.value.value=l.account,w.value.value=l.name,C.value.value=l.nickname,S.value.value=l.email,P.value.value=l.phone,$.value.value=l.birthday?te(l.birthday):""):(k.value=!1,r.value.id="",H()),r.value.open=!0},te=l=>{const e=new Date(l),a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),I=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${I}`},A=()=>{r.value.open=!1,H()},oe=()=>{h.value.open=!0},R=()=>{h.value.open=!1},se=ke({account:d().required("請輸入帳號").min(4,"帳號至少需輸入8個字").max(20,"帳號長度不得超過20個字").test("isAlphanumeric","帳號只能輸入英數字",l=>B.isAlphanumeric(l)),password:d().when("$isEditing",{is:!1,then:()=>d().required("請輸入密碼").min(8,"密碼至少需輸入8個字"),otherwise:()=>d().notRequired()}),name:d().required("請輸入姓名"),nickname:d().nullable(),email:d().required("請輸入信箱").test("isEmail","請輸入正確的信箱格式",l=>B.isEmail(l)),phone:d().required("請輸入手機號碼").min(10,"請輸入10碼手機號碼").test("isMobilePhone","請輸入正確的手機號碼格式",l=>B.isMobilePhone(l)),birthday:d().required("請輸入生日").test("isDate","請輸入正確的日期格式",l=>B.isDate(l))}).test("$isEditing","",()=>!0),{handleSubmit:ne,isSubmitting:f,resetForm:H}=he({validationSchema:se,initialValues:{account:"",name:"",nickname:"",email:"",phone:"",birthday:"",password:""},validateOnMount:!1}),x=g("account"),E=g("password"),w=g("name"),C=g("nickname"),S=g("email"),P=g("phone"),$=g("birthday"),re=ne(async l=>{var e,a;try{const n={account:l.account.toLowerCase(),name:l.name,nickname:l.nickname,email:l.email,phone:l.phone,birthday:l.birthday?new Date(l.birthday).toISOString():void 0};k.value?await q.patch("/user/"+r.value.id,n):(n.password=l.password,await le.post("/user",n)),b({text:k.value?"編輯成功":"新增成功",snackbarProps:{color:"teal-darken-1"}}),A(),m(!0)}catch(n){console.error("Error in submit function",n),console.error("Error response:",n.response),b({text:((a=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}}),F=i(10),D=i([{key:"createdAt",order:"desc"}]),M=i(1),T=i([]),ie=[{title:"帳號",align:"left",sortable:!1,key:"account"},{title:"姓名",align:"left",sortable:!0,key:"name"},{title:"暱稱",align:"left",sortable:!0,key:"nickname"},{title:"email",align:"left",sortable:!0,key:"email"},{title:"手機",align:"left",sortable:!0,key:"phone"},{title:"操作",align:"left",sortable:!1,key:"action"}],L=i(!0),J=i(0),U=i(""),m=async l=>{var e,a,n,I;l&&(M.value=1),L.value=!0;try{const{data:c}=await q.get("/user/all",{params:{page:M.value,itemsPerPage:F.value,sortBy:((e=D.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=D.value[0])==null?void 0:a.order)||"desc",search:U.value,role:0}});T.value.splice(0,T.value.length,...c.result.data),J.value=c.result.memberTotal}catch(c){console.log(c),b({text:((I=(n=c==null?void 0:c.response)==null?void 0:n.data)==null?void 0:I.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}L.value=!1};m();const ue=async()=>{var l,e;if(r.value.id)try{f.value=!0,await q.delete(`/user/${r.value.id}`),b({text:"刪除成功",snackbarProps:{color:"teal-darken-1"}}),A(),R(),m(!0)}catch(a){console.log(a),b({text:((e=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{f.value=!1}};return(l,e)=>(N(),pe(ce,null,[t(xe,null,{default:s(()=>[t(we,null,{default:s(()=>[t(z,{cols:"12"},{default:s(()=>[$e]),_:1}),t(z,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:s(()=>[t(v,{class:"custom-btn",onClick:e[0]||(e[0]=a=>K(null))},{default:s(()=>[u(" 新增會員 ")]),_:1}),t(O),t(p,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240",onClickAppend:e[2]||(e[2]=a=>m(!0)),onKeydown:e[3]||(e[3]=ve(a=>m(!0),["enter"]))},null,8,["modelValue"])]),_:1}),t(z,{cols:"12"},{default:s(()=>[t(Ce,{"items-per-page":F.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>F.value=a),e[7]||(e[7]=a=>m(!1))],"sort-by":D.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>D.value=a),e[8]||(e[8]=a=>m(!1))],page:M.value,"onUpdate:page":[e[6]||(e[6]=a=>M.value=a),e[9]||(e[9]=a=>m(!1))],"items-per-page-options":[10,20,50],items:T.value,headers:ie,loading:L.value,"items-length":J.value,search:U.value,hover:""},{top:s(()=>[]),"item.action":s(({item:a})=>[t(v,{class:"edit-btn",icon:"mdi-pencil",variant:"plain",onClick:n=>K(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(Y,{modelValue:r.value.open,"onUpdate:modelValue":e[18]||(e[18]=a=>r.value.open=a),persistent:"",width:"440"},{default:s(()=>[t(Se,{disabled:o(f),onSubmit:ge(o(re),["prevent"])},{default:s(()=>[t(G,{class:"rounded-xl pa-4 pt-6"},{default:s(()=>[t(Q,{style:{"font-size":"18px"}},{default:s(()=>[u(fe(r.value.id?"會員資料編輯":"新增會員"),1)]),_:1}),t(W,{class:"mt-3 pa-3"},{default:s(()=>[t(p,{modelValue:o(x).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>o(x).value.value=a),"error-messages":o(x).errorMessage.value,label:"帳號",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(w).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>o(w).value.value=a),"error-messages":o(w).errorMessage.value,class:"mt-2",label:"姓名",type:"text",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(C).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>o(C).value.value=a),"error-messages":o(C).errorMessage.value,class:"mt-2",label:"暱稱",type:"text",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(S).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o(S).value.value=a),"error-messages":o(S).errorMessage.value,class:"mt-2",label:"email",type:"email",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(P).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>o(P).value.value=a),"error-messages":o(P).errorMessage.value,class:"mt-2",label:"手機號碼",type:"text",variant:"outlined",density:"compact","min-length":"10",maxlength:"10",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o($).value.value,"onUpdate:modelValue":e[15]||(e[15]=a=>o($).value.value=a),"error-messages":o($).errorMessage.value,class:"mt-2",label:"生日",type:"date",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),r.value.id?Z("",!0):(N(),X(p,{key:0,modelValue:o(E).value.value,"onUpdate:modelValue":e[16]||(e[16]=a=>o(E).value.value=a),"error-messages":o(E).errorMessage.value,class:"mt-2",label:"密碼",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:"",type:V.value?"text":"password","append-inner-icon":V.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[17]||(e[17]=a=>V.value=!V.value)},null,8,["modelValue","error-messages","type","append-inner-icon"]))]),_:1}),t(_,null,{default:s(()=>[r.value.id?(N(),X(v,{key:0,color:"red",loading:o(f),onClick:oe},{default:s(()=>[u(" 刪除 ")]),_:1},8,["loading"])):Z("",!0),t(O),t(v,{color:"red",loading:o(f),onClick:A},{default:s(()=>[u(" 取消 ")]),_:1},8,["loading"]),t(v,{color:"green",type:"submit",loading:o(f)},{default:s(()=>[u(" 送出 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),t(Y,{modelValue:h.value.open,"onUpdate:modelValue":e[19]||(e[19]=a=>h.value.open=a),"max-width":"320"},{default:s(()=>[t(G,{class:"px-4 py-3"},{default:s(()=>[t(Q,{class:"headline",style:{"font-size":"18px"}},{default:s(()=>[u(" 確認刪除 ")]),_:1}),t(W,{class:"mt-3 pa-4"},{default:s(()=>[u(" 您確定要刪除此會員嗎？此操作無法撤銷。 ")]),_:1}),t(_,null,{default:s(()=>[t(O),t(v,{color:"green darken-1",text:"",onClick:R},{default:s(()=>[u(" 取消 ")]),_:1}),t(v,{color:"red darken-1",text:"",onClick:ue},{default:s(()=>[u(" 刪除 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof ee=="function"&&ee(ae);const Je=de(ae,[["__scopeId","data-v-55140673"]]);export{Je as default};
