import{D as W,G as X,H as Y,d as e,m as H,aO as se,aP as oe,J,aQ as ne,c as ue,al as ie,aR as re,aS as M,F as Z,aT as de,_ as ce,i as pe,r as d,a as me,b as fe,w as a,B as T,o as ve,ax as $,aK as ge,aL as Ve,g as n,t as I,I as b,q as G,x as O,A as N,aN as F,C as ye,p as be,h as _e,j as ke}from"./index-Cy-J-p7X.js";import{b as Q}from"./route-block-B_A1xBdJ.js";import{V as xe}from"./VContainer-DB2bvprN.js";import{V as Ce,a as j}from"./VRow-iwSDCQ95.js";import{V as Pe}from"./VDataTableServer-Ci8q2VwW.js";import{V as we}from"./VChip-BlzE_w_S.js";import{V as Ie,a as z,c as R}from"./VList-D6viAp6Z.js";import{m as Se,V as q,a as De,b as he}from"./VCheckboxBtn-CsPb-Jpm.js";import"./VDataTable-GJhs8FRK.js";import"./VPagination-BKz62pzz.js";import"./VSelect-C2VPtGcc.js";import"./filter-KUjAvYKs.js";import"./VDivider-CCxL3Tw5.js";const $e=W({...Se({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),K=X()({name:"VRadio",props:$e(),setup(s,m){let{slots:p}=m;return Y(()=>{const u=q.filterProps(s);return e(q,H(u,{class:["v-radio",s.class],style:s.style,type:"radio"}),p)}),{}}}),ze=W({height:{type:[Number,String],default:"auto"},...se(),...oe(De(),["multiple"]),trueIcon:{type:J,default:"$radioOn"},falseIcon:{type:J,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Re=X()({name:"VRadioGroup",inheritAttrs:!1,props:ze(),emits:{"update:modelValue":s=>!0},setup(s,m){let{attrs:p,slots:u}=m;const r=ne(),S=ue(()=>s.id||`radio-group-${r}`),_=ie(s,"modelValue");return Y(()=>{const[U,D]=re(p),c=M.filterProps(s),A=q.filterProps(s),k=u.label?u.label({label:s.label,props:{for:S.value}}):s.label;return e(M,H({class:["v-radio-group",s.class],style:s.style},U,c,{modelValue:_.value,"onUpdate:modelValue":f=>_.value=f,id:S.value}),{...u,default:f=>{let{id:P,messagesId:w,isDisabled:x,isReadonly:C}=f;return e(Z,null,[k&&e(de,{id:P.value},{default:()=>[k]}),e(he,H(A,{id:P.value,"aria-describedby":w.value,defaultsTarget:"VRadio",trueIcon:s.trueIcon,falseIcon:s.falseIcon,type:s.type,disabled:x.value,readonly:C.value,"aria-labelledby":k?P.value:void 0,multiple:!1},D,{modelValue:_.value,"onUpdate:modelValue":v=>_.value=v}),u)])}})}),{}}}),Ue=s=>(be("data-v-5ccb1f57"),s=s(),_e(),s),Ae=Ue(()=>ke("h2",{class:"text-center"}," 收件匣 ",-1)),ee={__name:"contact",setup(s){const{apiAuth:m}=ye(),p=pe(),u=d({open:!1,item:null}),r=d({open:!1,item:null,status:""}),S=i=>{u.value.item=i,u.value.open=!0},_=()=>{u.value.open=!1,u.value.item=null},U=i=>{r.value.item=i,r.value.status=i.status,r.value.open=!0},D=()=>{r.value.open=!1,r.value.item=null,r.value.status=""},c=d({open:!1,item:null}),A=i=>{c.value.item=i,c.value.open=!0},k=()=>{c.value.open=!1,c.value.item=null},f=d(!1),P=async()=>{var i,l;if(c.value.item)try{f.value=!0,await m.delete(`/contact/${c.value.item._id}`),p({text:"聯絡表單已成功刪除",snackbarProps:{color:"success"}}),k(),g(!0)}catch(o){console.log(o),p({text:((l=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:l.message)||"刪除失敗",snackbarProps:{color:"error"}})}finally{f.value=!1}},w=d(10),x=d([{key:"createdAt",order:"desc"}]),C=d(1),v=d([]),te=[{title:"姓名",align:"left",sortable:!0,key:"name",width:"110"},{title:"信箱",align:"left",sortable:!0,key:"email",width:"170"},{title:"主旨",align:"left",sortable:!0,key:"subject",width:"170"},{title:"內容",align:"left",sortable:!1,key:"content",width:"150"},{title:"狀態",align:"left",sortable:!0,key:"status",width:"150"},{title:"操作",align:"center",sortable:!1,key:"action",width:"100"}],B=d(!0),E=d(0),h=d(""),g=async i=>{var l,o,t,V;i&&(C.value=1),B.value=!0;try{const{data:y}=await m.get("/contact",{params:{page:C.value,itemsPerPage:w.value,sortBy:((l=x.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((o=x.value[0])==null?void 0:o.order)||"desc",search:h.value}});v.value.splice(0,v.value.length,...y.result.data),E.value=y.result.total}catch(y){console.log(y),p({text:((V=(t=y==null?void 0:y.response)==null?void 0:t.data)==null?void 0:V.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}B.value=!1},L=d(!1),ae=async()=>{var i,l;if(r.value.item)try{L.value=!0;const{data:o}=await m.patch(`/contact/${r.value.item._id}/status`,{status:r.value.status}),t=v.value.findIndex(V=>V._id===r.value.item._id);t!==-1&&(v.value[t].status=o.result.status),p({text:"狀態更新成功",snackbarProps:{color:"teal-darken-1"}}),D()}catch(o){console.log(o),p({text:((l=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{L.value=!1}},le=i=>{switch(i){case"待處理":return"warning";case"處理中":return"info";case"已完成":return"success";default:return"grey"}};return g(),(i,l)=>{const o=me("v-list-item-text");return ve(),fe(Z,null,[e(xe,null,{default:a(()=>[e(Ce,null,{default:a(()=>[e(j,{cols:"12"},{default:a(()=>[Ae]),_:1}),e(j,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:a(()=>[e($),e(ge,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=t=>h.value=t),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240","onClick:append":l[1]||(l[1]=t=>g(!0)),onKeydown:l[2]||(l[2]=Ve(t=>g(!0),["enter"]))},null,8,["modelValue"])]),_:1}),e(j,{cols:"12"},{default:a(()=>[e(Pe,{"items-per-page":w.value,"onUpdate:itemsPerPage":[l[3]||(l[3]=t=>w.value=t),l[6]||(l[6]=t=>g(!1))],"sort-by":x.value,"onUpdate:sortBy":[l[4]||(l[4]=t=>x.value=t),l[7]||(l[7]=t=>g(!1))],page:C.value,"onUpdate:page":[l[5]||(l[5]=t=>C.value=t),l[8]||(l[8]=t=>g(!1))],"items-per-page-options":[10,20,50],items:v.value,headers:te,loading:B.value,"items-length":E.value,search:h.value,hover:""},{top:a(()=>[]),"item.status":a(({item:t})=>[e(we,{color:le(t.status),onClick:V=>U(t)},{default:a(()=>[n(I(t.status),1)]),_:2},1032,["color","onClick"])]),"item.content":a(({item:t})=>[e(b,{class:"view-btn",icon:"mdi-eye",size:"small",variant:"plain",onClick:V=>S(t)},null,8,["onClick"])]),"item.action":a(({item:t})=>[e(b,{class:"delete-btn",color:"red-darken-1",icon:"mdi-delete",size:"small",variant:"plain",onClick:V=>A(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),e(T,{modelValue:u.value.open,"onUpdate:modelValue":l[9]||(l[9]=t=>u.value.open=t),width:"520"},{default:a(()=>[e(G,{class:"rounded-xl py-4 px-8 pt-6"},{default:a(()=>[e(O,{style:{"font-size":"18px"}},{default:a(()=>[n(" 查看完整信件 ")]),_:1}),e(N,{class:"mt-3 pa-0"},{default:a(()=>[e(Ie,null,{default:a(()=>[e(z,null,{default:a(()=>[e(R,{class:"card-title"},{default:a(()=>[n(" 姓名 ")]),_:1}),e(o,{class:"card-text"},{default:a(()=>{var t;return[n(I((t=u.value.item)==null?void 0:t.name),1)]}),_:1})]),_:1}),e(z,null,{default:a(()=>[e(R,{class:"card-title"},{default:a(()=>[n(" 信箱 ")]),_:1}),e(o,{class:"card-text"},{default:a(()=>{var t;return[n(I((t=u.value.item)==null?void 0:t.email),1)]}),_:1})]),_:1}),e(z,null,{default:a(()=>[e(R,{class:"card-title"},{default:a(()=>[n(" 主旨 ")]),_:1}),e(o,{class:"card-text"},{default:a(()=>{var t;return[n(I((t=u.value.item)==null?void 0:t.subject),1)]}),_:1})]),_:1}),e(z,null,{default:a(()=>[e(R,{class:"card-title"},{default:a(()=>[n(" 內容 ")]),_:1}),e(o,{class:"card-text"},{default:a(()=>{var t;return[n(I((t=u.value.item)==null?void 0:t.content),1)]}),_:1})]),_:1})]),_:1})]),_:1}),e(F,null,{default:a(()=>[e($),e(b,{color:"primary",variant:"outlined",onClick:_},{default:a(()=>[n(" 關閉 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(T,{modelValue:r.value.open,"onUpdate:modelValue":l[11]||(l[11]=t=>r.value.open=t),width:"400"},{default:a(()=>[e(G,{class:"rounded-xl pa-4 pt-6"},{default:a(()=>[e(O,{style:{"font-size":"16px"}},{default:a(()=>[n(" 更新狀態 ")]),_:1}),e(N,{class:"mt-3 pa-3"},{default:a(()=>[e(Re,{modelValue:r.value.status,"onUpdate:modelValue":l[10]||(l[10]=t=>r.value.status=t)},{default:a(()=>[e(K,{label:"待處理",value:"待處理",style:{"font-size":"14px"}}),e(K,{label:"處理中",value:"處理中",style:{"font-size":"14px"}}),e(K,{label:"已完成",value:"已完成",style:{"font-size":"14px"}})]),_:1},8,["modelValue"])]),_:1}),e(F,null,{default:a(()=>[e($),e(b,{color:"red-lighten-1",size:"small",variant:"outlined",onClick:D},{default:a(()=>[n(" 取消 ")]),_:1}),e(b,{color:"teal-darken-1",size:"small",variant:"outlined",loading:L.value,onClick:ae},{default:a(()=>[n(" 更新 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(T,{modelValue:c.value.open,"onUpdate:modelValue":l[12]||(l[12]=t=>c.value.open=t),width:"400"},{default:a(()=>[e(G,{class:"rounded-xl pa-4 pt-6"},{default:a(()=>[e(O,{style:{"font-size":"16px"}},{default:a(()=>[n(" 確認刪除 ")]),_:1}),e(N,{class:"mt-3 pa-4",style:{"font-size":"14px"}},{default:a(()=>[n(" 您確定要刪除此信件嗎？此操作無法撤銷。 ")]),_:1}),e(F,null,{default:a(()=>[e($),e(b,{color:"grey",size:"small",variant:"outlined",onClick:k},{default:a(()=>[n(" 取消 ")]),_:1}),e(b,{color:"error",size:"small",variant:"outlined",loading:f.value,onClick:P},{default:a(()=>[n(" 刪除 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};typeof Q=="function"&&Q(ee);const Me=ce(ee,[["__scopeId","data-v-5ccb1f57"]]);export{Me as default};
