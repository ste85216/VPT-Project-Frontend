import{_ as D,au as F,i as L,u as M,r as h,l as R,ad as E,a as G,b,d as e,w as a,bD as J,F as k,o as d,s as O,j as c,t as p,bj as Q,g as u,f as I,I as x,V as S,aN as H,C as K,bJ as W,n as P,p as X,h as Y}from"./index-bPQGEcwX.js";import{_ as Z}from"./CartIcon-Cb7L6I85.js";import{b as A}from"./route-block-B_A1xBdJ.js";import{V as ee}from"./VContainer-D5GfIWkL.js";import{V as ae,a as n}from"./VRow-CBKOBz4u.js";import{a as B,V as $}from"./VChip-DFzPSEwX.js";const V=m=>(X("data-v-c7fdf443"),m=m(),Y(),m),te=V(()=>c("h3",null,"尺寸",-1)),se=V(()=>c("h3",null,"顏色",-1)),le=V(()=>c("h3",null,"數量",-1)),oe={class:"px-5"},re={class:"d-flex align-center pe-1"},ne=V(()=>c("h1",{class:"no-sell-title"}," 此商品已下架 ",-1)),j={__name:"[id]",emits:["update:category"],setup(m,{emit:N}){const{apiAuth:C}=K(),T=F(),i=L(),f=M(),s=h({_id:"",name:"",price:0,images:[],sell:!0,description:"",category:"",colors:[],sizes:[]}),_=h(""),v=h(""),g=h(1),z=async()=>{var r,l;try{const{data:o}=await C.get(`/product/${T.params.id}`);s.value=o.result,typeof s.value.colors=="string"&&(s.value.colors=s.value.colors.split(",")),typeof s.value.sizes=="string"&&(s.value.sizes=s.value.sizes.split(",")),document.title=`${s.value.name} | VPT`,U("update:category",s.value.category)}catch(o){console.log(o),i({text:((l=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}};R(()=>{z()});const U=N,w=r=>{g.value=Math.max(1,g.value+r)},q=async()=>{var l,o;if(!f.isLogin){i({text:"請先登入",snackbarProps:{color:"red-lighten-1"}}),W.push("/loginregister");return}if(!_.value||!v.value){i({text:"請選擇尺寸和顏色",snackbarProps:{color:"red-lighten-1"}});return}const r={p_id:s.value._id,colors:v.value,sizes:_.value,quantity:g.value};try{const{data:t}=await C.patch("/user/cart",r);i({text:"商品已加入購物車",snackbarProps:{color:"teal-darken-1"}}),t.result&&Array.isArray(t.result.cart)?f.cart=[...t.result.cart]:console.error("購物車數據結構錯誤",t.result.cart)}catch(t){console.log(t),i({text:((o=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}};return z(),E(()=>f.cart,r=>{f.cart=r}),(r,l)=>{const o=G("router-link");return d(),b(k,null,[e(ee,null,{default:a(()=>[e(ae,null,{default:a(()=>[e(n,{class:"pa-0 pt-5 pb-4",cols:"12",sm:"6"},{default:a(()=>[e(O,{src:s.value.images[0],class:"rounded-xl elevation-6 product-img",cover:""},null,8,["src"])]),_:1}),e(n,{cols:"12",sm:"6",class:"ps-0 ps-sm-10"},{default:a(()=>[e(n,null,{default:a(()=>[c("h2",null,p(s.value.name),1),e(Q,{class:"custom-subtitle mt-2"},{default:a(()=>[u(p(s.value.description),1)]),_:1})]),_:1}),e(n,null,{default:a(()=>[te,e(B,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=t=>_.value=t),class:"pa-0",column:"",filter:""},{default:a(()=>[(d(!0),b(k,null,I(s.value.sizes,(t,y)=>(d(),P($,{key:y,value:t,size:"large",color:"teal-lighten-1"},{default:a(()=>[u(p(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:a(()=>[se,e(B,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=t=>v.value=t),class:"pa-0",column:"",filter:""},{default:a(()=>[(d(!0),b(k,null,I(s.value.colors,(t,y)=>(d(),P($,{key:y,value:t,size:"large",color:"teal-lighten-1"},{default:a(()=>[u(p(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n,{class:"mb-0 mb-sm-16"},{default:a(()=>[le,e(x,{size:"x-small",icon:"",variant:"text",color:"red",onClick:l[2]||(l[2]=t=>w(-1))},{default:a(()=>[e(S,null,{default:a(()=>[u("mdi-minus")]),_:1})]),_:1}),c("span",oe,p(g.value),1),e(x,{size:"x-small",icon:"",variant:"text",color:"#039199",onClick:l[3]||(l[3]=t=>w(1))},{default:a(()=>[e(S,null,{default:a(()=>[u("mdi-plus")]),_:1})]),_:1})]),_:1}),e(n,{class:"py-0"},{default:a(()=>[e(H,{class:"pa-0",justify:"center"},{default:a(()=>[e(x,{class:"addCart-btn",block:"",variant:"outlined",onClick:q},{default:a(()=>[c("div",re,[e(Z,{size:20})]),u(" 加入購物車 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(n,{cols:"12"})]),_:1}),e(J,{class:"align-center justify-center","model-value":!s.value.sell,persistent:""},{default:a(()=>[ne,e(o,{class:"no-sell-subtitle",to:"/products"},{default:a(()=>[u(" 逛逛其他商品 → ")]),_:1})]),_:1},8,["model-value"])],64)}}};typeof A=="function"&&A(j);const fe=D(j,[["__scopeId","data-v-c7fdf443"]]);export{fe as default};
