import{_ as de,i as me,r as i,o as N,b as pe,d as t,w as s,C as Y,F as ce,D as j,J as g,g as u,ay as O,aL as v,aM as ve,e as o,aN as ge,s as G,y as Q,t as fe,B as W,q as X,A as Z,aO as _,p as be,k as ye,h as Ve}from"./index-D8_YgM4t.js";import{v as A}from"./index-DcBOdE6S.js";import{c as ke,a as d,u as he,b as f}from"./vee-validate.esm-DZsSq6ct.js";import{b as ee}from"./route-block-B_A1xBdJ.js";import{V as xe}from"./VContainer-CYDGPcmm.js";import{V as we,a as z}from"./VRow-C1kd7m8I.js";import{V as Ce}from"./VDataTableServer-DV8aVi4Y.js";import{V as Se}from"./VForm-B31zVhoK.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-aoJWsOLO.js";import"./VPagination-DQvQBcOm.js";import"./VSelect-CmCYAyxr.js";import"./VList-BaLB9WI-.js";import"./VDivider-C1XI641t.js";import"./VCheckboxBtn-kkVih5Sz.js";import"./VChip-DjFW6d1W.js";import"./filter-BpyBqvF4.js";const Pe=V=>(be("data-v-444a7043"),V=V(),ye(),V),$e=Pe(()=>Ve("h2",{class:"text-center"}," 會員管理 ",-1)),ae={__name:"member",setup(V){const{apiAuth:q}=j(),{api:le}=j(),y=me(),k=i(!1),h=i(!1),r=i({open:!1,id:""}),x=i({open:!1}),K=l=>{l?(h.value=!0,r.value.id=l._id,w.value.value=l.account,C.value.value=l.name,S.value.value=l.nickname,P.value.value=l.email,$.value.value=l.phone,D.value.value=l.birthday?te(l.birthday):""):(h.value=!1,r.value.id="",H()),r.value.open=!0},te=l=>{const e=new Date(l),a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${p}`},B=()=>{r.value.open=!1,H()},oe=()=>{x.value.open=!0},R=()=>{x.value.open=!1},se=ke({account:d().required("請輸入帳號").min(4,"帳號至少需輸入8個字").max(20,"帳號長度不得超過20個字").test("isAlphanumeric","帳號只能輸入英數字",l=>A.isAlphanumeric(l)),password:d().when("$isEditing",{is:!1,then:()=>d().required("請輸入密碼").min(8,"密碼至少需輸入8個字"),otherwise:()=>d().notRequired()}),name:d().required("請輸入姓名"),nickname:d().required("請輸入暱稱"),email:d().required("請輸入信箱").test("isEmail","請輸入正確的信箱格式",l=>A.isEmail(l)),phone:d().required("請輸入手機號碼").min(10,"請輸入10碼手機號碼").test("isMobilePhone","請輸入正確的手機號碼格式",l=>A.isMobilePhone(l)),birthday:d().required("請輸入生日").test("isDate","請輸入正確的日期格式",l=>A.isDate(l))}).test("$isEditing","",()=>!0),{handleSubmit:ne,isSubmitting:b,resetForm:H}=he({validationSchema:se,initialValues:{account:"",name:"",nickname:"",email:"",phone:"",birthday:"",password:""},validateOnMount:!1}),w=f("account"),E=f("password"),C=f("name"),S=f("nickname"),P=f("email"),$=f("phone"),D=f("birthday"),re=ne(async l=>{var e,a;console.log("Submit function called",l);try{const n={account:l.account.toLowerCase(),name:l.name,nickname:l.nickname,email:l.email,phone:l.phone,birthday:l.birthday?new Date(l.birthday).toISOString():void 0};console.log("Payload prepared",n);let p;h.value?p=await q.patch("/user/"+r.value.id,n):(n.password=l.password,p=await le.post("/user",n)),console.log("API response",p),y({text:h.value?"編輯成功":"新增成功",snackbarProps:{color:"teal-darken-1"}}),B(),m(!0)}catch(n){console.error("Error in submit function",n),console.error("Error response:",n.response),y({text:((a=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}}),F=i(10),M=i([{key:"createdAt",order:"desc"}]),U=i(1),T=i([]),ie=[{title:"帳號",align:"left",sortable:!1,key:"account"},{title:"姓名",align:"left",sortable:!0,key:"name"},{title:"暱稱",align:"left",sortable:!0,key:"nickname"},{title:"email",align:"left",sortable:!0,key:"email"},{title:"手機",align:"left",sortable:!0,key:"phone"},{title:"操作",align:"left",sortable:!1,key:"action"}],L=i(!0),J=i(0),I=i(""),m=async l=>{var e,a,n,p;l&&(U.value=1),L.value=!0;try{const{data:c}=await q.get("/user/all",{params:{page:U.value,itemsPerPage:F.value,sortBy:((e=M.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=M.value[0])==null?void 0:a.order)||"desc",search:I.value,role:0}});console.log(c),T.value.splice(0,T.value.length,...c.result.data),J.value=c.result.memberTotal}catch(c){console.log(c),y({text:((p=(n=c==null?void 0:c.response)==null?void 0:n.data)==null?void 0:p.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}L.value=!1};m();const ue=async()=>{var l,e;if(r.value.id)try{b.value=!0,await q.delete(`/user/${r.value.id}`),y({text:"刪除成功",snackbarProps:{color:"teal-darken-1"}}),B(),R(),m(!0)}catch(a){console.log(a),y({text:((e=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{b.value=!1}};return(l,e)=>(N(),pe(ce,null,[t(xe,null,{default:s(()=>[t(we,null,{default:s(()=>[t(z,{cols:"12"},{default:s(()=>[$e]),_:1}),t(z,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:s(()=>[t(g,{class:"custom-btn",onClick:e[0]||(e[0]=a=>K(null))},{default:s(()=>[u(" 新增會員 ")]),_:1}),t(O),t(v,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=a=>I.value=a),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240",onClickAppend:e[2]||(e[2]=a=>m(!0)),onKeydown:e[3]||(e[3]=ve(a=>m(!0),["enter"]))},null,8,["modelValue"])]),_:1}),t(z,{cols:"12"},{default:s(()=>[t(Ce,{"items-per-page":F.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>F.value=a),e[7]||(e[7]=a=>m(!1))],"sort-by":M.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>M.value=a),e[8]||(e[8]=a=>m(!1))],page:U.value,"onUpdate:page":[e[6]||(e[6]=a=>U.value=a),e[9]||(e[9]=a=>m(!1))],"items-per-page-options":[10,20,50],items:T.value,headers:ie,loading:L.value,"items-length":J.value,search:I.value,hover:""},{top:s(()=>[]),"item.action":s(({item:a})=>[t(g,{class:"edit-btn",icon:"mdi-pencil",variant:"plain",onClick:n=>K(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(Y,{modelValue:r.value.open,"onUpdate:modelValue":e[18]||(e[18]=a=>r.value.open=a),persistent:"",width:"440"},{default:s(()=>[t(Se,{disabled:o(b),onSubmit:ge(o(re),["prevent"])},{default:s(()=>[t(G,{class:"rounded-xl pa-4 pt-6"},{default:s(()=>[t(Q,{style:{"font-size":"18px"}},{default:s(()=>[u(fe(r.value.id?"會員資料編輯":"新增會員"),1)]),_:1}),t(W,{class:"mt-3 pa-3"},{default:s(()=>[t(v,{modelValue:o(w).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>o(w).value.value=a),"error-messages":o(w).errorMessage.value,label:"帳號",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(v,{modelValue:o(C).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>o(C).value.value=a),"error-messages":o(C).errorMessage.value,class:"mt-2",label:"姓名",type:"text",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(v,{modelValue:o(S).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>o(S).value.value=a),"error-messages":o(S).errorMessage.value,class:"mt-2",label:"暱稱",type:"text",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"]),t(v,{modelValue:o(P).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o(P).value.value=a),"error-messages":o(P).errorMessage.value,class:"mt-2",label:"email",type:"email",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(v,{modelValue:o($).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>o($).value.value=a),"error-messages":o($).errorMessage.value,class:"mt-2",label:"手機號碼",type:"text",variant:"outlined",density:"compact","min-length":"10",maxlength:"10",clearable:""},null,8,["modelValue","error-messages"]),t(v,{modelValue:o(D).value.value,"onUpdate:modelValue":e[15]||(e[15]=a=>o(D).value.value=a),"error-messages":o(D).errorMessage.value,class:"mt-2",label:"生日",type:"date",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),r.value.id?Z("",!0):(N(),X(v,{key:0,modelValue:o(E).value.value,"onUpdate:modelValue":e[16]||(e[16]=a=>o(E).value.value=a),"error-messages":o(E).errorMessage.value,class:"mt-2",label:"密碼",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:"",type:k.value?"text":"password","append-inner-icon":k.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[17]||(e[17]=a=>k.value=!k.value)},null,8,["modelValue","error-messages","type","append-inner-icon"]))]),_:1}),t(_,null,{default:s(()=>[r.value.id?(N(),X(g,{key:0,color:"red",loading:o(b),onClick:oe},{default:s(()=>[u(" 刪除 ")]),_:1},8,["loading"])):Z("",!0),t(O),t(g,{color:"red",loading:o(b),onClick:B},{default:s(()=>[u(" 取消 ")]),_:1},8,["loading"]),t(g,{color:"green",type:"submit",loading:o(b)},{default:s(()=>[u(" 送出 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),t(Y,{modelValue:x.value.open,"onUpdate:modelValue":e[19]||(e[19]=a=>x.value.open=a),"max-width":"320"},{default:s(()=>[t(G,{class:"px-4 py-3"},{default:s(()=>[t(Q,{class:"headline",style:{"font-size":"18px"}},{default:s(()=>[u(" 確認刪除 ")]),_:1}),t(W,{class:"mt-3 pa-4"},{default:s(()=>[u(" 您確定要刪除此會員嗎？此操作無法撤銷。 ")]),_:1}),t(_,null,{default:s(()=>[t(O),t(g,{color:"green darken-1",text:"",onClick:R},{default:s(()=>[u(" 取消 ")]),_:1}),t(g,{color:"red darken-1",text:"",onClick:ue},{default:s(()=>[u(" 刪除 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof ee=="function"&&ee(ae);const Je=de(ae,[["__scopeId","data-v-444a7043"]]);export{Je as default};
