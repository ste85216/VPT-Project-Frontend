import{_ as R,bh as E,u as M,i as Q,r as h,c as G,b as $,d as a,w as s,F as N,o as b,n as S,q as V,z as H,f as J,j as _,t as v,I as k,g as O,C as W,s as X,V as I,aK as Y,aL as Z,p as ee,h as ae}from"./index-BhgYcuyT.js";import{C as te}from"./ConfirmDeleteDialog-CUwJ3oOd.js";import{V as se}from"./VContainer-2RJGpisN.js";import{V as m,a as c}from"./VRow-KTuWc2g4.js";import{V as le}from"./VTextarea-C9tFr3F0.js";const w=y=>(ee("data-v-e0b7b4be"),y=y(),ae(),y),ne=w(()=>_("h2",{class:"mb-5"}," 購物車 ",-1)),oe=w(()=>_("div",{class:"text-gray"}," 購物車內尚未加入商品 ",-1)),ce={class:"card-text"},ue={class:"card-text"},ie=w(()=>_("h4",{class:"note-title"}," 訂單備註 ",-1)),re=w(()=>_("h4",{class:"total-price-title"}," 結帳金額 ",-1)),de={class:"total-price"},fe={__name:"cart",setup(y){const{apiAuth:A}=W(),g=E(),d=M(),q=Q(),n=h([]),f=h(!1),C=h(""),u=h({open:!1}),L=async()=>{var e,l;try{const{data:t}=await A.get("/user/cart"),o=t.result.filter(r=>r.p_id&&r.p_id.sell),i=t.result.filter(r=>!r.p_id||!r.p_id.sell);for(const r of i)await B(r,!1);n.value=o.sort((r,p)=>new Date(p.createdAt)-new Date(r.createdAt)),d.cart=o}catch(t){q({text:((l=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}},j=async e=>{(!e.quantity||e.quantity<1)&&(e.quantity=1),await x(e,e.quantity)},U=e=>{(isNaN(e.quantity)||e.quantity===null||e.quantity==="")&&(e.quantity=1)},z=async(e,l)=>{if(!d.isLogin){g.push("/login");return}if(l<1){u.value={open:!0,title:"您確認要移除嗎？",message:"",action:async()=>{await x(e,0),n.value=n.value.filter(t=>t._id!==e._id)}};return}e.quantity=l,await x(e,l)},B=async(e,l=!0)=>{if(!d.isLogin){g.push("/login");return}const t=async()=>{await x(e,0),n.value=n.value.filter(o=>o._id!==e._id)};l?u.value={open:!0,title:"您確認要移除嗎？",message:"",action:t}:await t()},K=async()=>{u.value.action&&await u.value.action(),D()},D=()=>{u.value.open=!1,u.value.action=null},x=async(e,l=null)=>{var t,o;if(!d.isLogin){g.push("/login");return}try{f.value=!0;const i=l!==null?l:e.quantity;if((await d.addCart(e.p_id._id,i,e.colors,e.sizes)).color==="green"){if(i===0)n.value=n.value.filter(p=>p._id!==e._id);else{const p=n.value.findIndex(T=>T._id===e._id);p!==-1&&(n.value[p]={...n.value[p],quantity:i})}d.cart=[...n.value]}f.value=!1}catch(i){f.value=!1,console.error(i),q({text:((o=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}},P=G(()=>n.value.reduce((e,l)=>e+l.p_id.price*l.quantity,0)),F=async()=>{f.value=!0;const e=await d.checkout(C.value);console.log(e),q({text:e.text,snackbarProps:{color:e.color}}),e.color==="teal-darken-1"&&(g.push("/member/order"),f.value=!1)};return L(),(e,l)=>(b(),$(N,null,[a(se,{class:"px-4 px-lg-0 py-0 mt-10 h-75",style:{"max-width":"1200px"}},{default:s(()=>[ne,a(m,null,{default:s(()=>[a(c,{cols:"12",sm:"7",md:"8"},{default:s(()=>[n.value.length===0?(b(),S(V,{key:0,class:"mb-4 cart-card d-flex justify-center align-center"},{default:s(()=>[oe]),_:1})):H("",!0),(b(!0),$(N,null,J(n.value,t=>(b(),S(V,{key:t._id,class:"mb-4 cart-card py-4 ps-4 pe-5"},{default:s(()=>[a(m,{"no-gutters":"",class:"d-flex justify-space-between"},{default:s(()=>[a(c,{cols:"4",md:"2",class:"d-flex align-center justify-center"},{default:s(()=>[a(X,{src:t.p_id.images[0],elevation:"0",height:"80",width:"80"},null,8,["src"])]),_:2},1024),a(c,{cols:"6",md:"9",class:"d-flex flex-column justify-center"},{default:s(()=>[a(m,{"no-gutters":""},{default:s(()=>[a(c,{cols:"12",md:"",class:"d-flex flex-column justify-center text-sm-center px-md-2"},{default:s(()=>[_("div",ce,v(t.p_id.name)+" / "+v(t.p_id.price)+" 元 ",1)]),_:2},1024),a(c,{cols:"12",md:"",class:"d-flex align-center justify-sm-center ps-md-2"},{default:s(()=>[_("div",ue,v(t.colors)+" / "+v(t.sizes),1)]),_:2},1024),a(c,{cols:"12",md:"4",class:"d-flex align-sm-center justify-sm-center"},{default:s(()=>[a(m,{"no-gutters":"",class:"d-flex align-sm-center justify-sm-center"},{default:s(()=>[a(c,{cols:"1",sm:"2",md:"4",class:"d-flex align-center justify-center me-3 me-md-0"},{default:s(()=>[a(k,{icon:"",size:"x-small",elevation:"0",class:"quantity-btn",onClick:o=>z(t,t.quantity-1)},{default:s(()=>[a(I,{icon:"mdi-minus",size:"small",class:"minus-btn"})]),_:2},1032,["onClick"])]),_:2},1024),a(c,{cols:"3",sm:"4",class:"d-flex align-center me-3 me-md-0"},{default:s(()=>[a(Y,{modelValue:t.quantity,"onUpdate:modelValue":o=>t.quantity=o,modelModifiers:{number:!0},type:"number",min:"1",variant:"outlined",density:"compact",class:"quantity-input",onInput:o=>U(t),onBlur:o=>j(t),onKeypress:Z(o=>j(t),["enter"])},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur","onKeypress"])]),_:2},1024),a(c,{cols:"1",sm:"2",md:"4",class:"d-flex align-center justify-center"},{default:s(()=>[a(k,{icon:"",size:"x-small",elevation:"0",class:"quantity-btn",onClick:o=>z(t,t.quantity+1)},{default:s(()=>[a(I,{icon:"mdi-plus",size:"small",class:"plus-btn"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(c,{cols:"1",md:"1",class:"d-flex align-center justify-center"},{default:s(()=>[a(k,{icon:"",class:"delete-btn",ripple:!1,variant:"plain",onClick:o=>B(t)},{default:s(()=>[a(I,{icon:"mdi-delete",color:"red-darken-3",class:"pb-2"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(c,{cols:"12",sm:"5",md:"4"},{default:s(()=>[a(V,{class:"pa-4 pb-0 cart-card mb-4",height:"160"},{default:s(()=>[a(m,null,{default:s(()=>[a(c,{cols:"12",class:"pb-0"},{default:s(()=>[ie]),_:1})]),_:1}),a(m,null,{default:s(()=>[a(c,{class:"pt-4"},{default:s(()=>[a(le,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=t=>C.value=t),rows:"2",variant:"outlined","auto-grow":"","base-color":"#666","hide-details":"","no-resize":"","max-rows":"2",disabled:f.value||n.value.length===0},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(V,{class:"pa-4 pb-0 cart-card",height:"150"},{default:s(()=>[a(m,{class:"d-flex flex-column h-100"},{default:s(()=>[a(c,{class:"d-flex justify-space-between"},{default:s(()=>[re,_("div",de," $"+v(P.value),1)]),_:1}),a(c,{class:"pb-0"},{default:s(()=>[a(k,{color:"primary",class:"checkout-btn",disabled:f.value||n.value.length===0,onClick:F},{default:s(()=>[O(" 結帳 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(te,{modelValue:u.value.open,"onUpdate:modelValue":l[1]||(l[1]=t=>u.value.open=t),title:u.value.title,message:u.value.message,"cancel-size":"small","confirm-size":"small",onConfirm:K,onCancel:D},null,8,["modelValue","title","message"])],64))}},ge=R(fe,[["__scopeId","data-v-e0b7b4be"]]);export{ge as default};
