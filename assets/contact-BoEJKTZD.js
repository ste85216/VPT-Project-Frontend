import{D as W,G as X,H as Y,d as e,m as H,aO as se,aP as oe,J,aQ as ne,c as ue,al as ie,aR as re,aS as M,F as Z,aT as de,_ as ce,i as pe,r as d,a as me,o as fe,b as ve,w as a,B as T,ax as h,aK as ge,aL as Ve,g as u,t as w,I as b,q as G,x as O,A as N,aN as F,C as ye,p as be,h as _e,j as ke}from"./index-B4OSjFhd.js";import{b as Q}from"./route-block-B_A1xBdJ.js";import{V as xe}from"./VContainer-yTfqOqgT.js";import{V as Ce,a as j}from"./VRow-CFfGAHZm.js";import{V as Pe}from"./VDataTableServer-DVqZxYJ2.js";import{V as we}from"./VChip-CCM9gAco.js";import{V as Ie,a as $,c as z}from"./VList-ujTqilol.js";import{m as Se,V as q,a as De,b as he}from"./VCheckboxBtn-CyNlhohC.js";import"./VDataTable-CPq7-26g.js";import"./VPagination-NmnQr0Ic.js";import"./VSelect-CBI1dblb.js";import"./filter-CgZK89kr.js";import"./VDivider-y-9_wbh9.js";const $e=W({...Se({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),K=X()({name:"VRadio",props:$e(),setup(s,m){let{slots:p}=m;return Y(()=>{const i=q.filterProps(s);return e(q,H(i,{class:["v-radio",s.class],style:s.style,type:"radio"}),p)}),{}}}),ze=W({height:{type:[Number,String],default:"auto"},...se(),...oe(De(),["multiple"]),trueIcon:{type:J,default:"$radioOn"},falseIcon:{type:J,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Re=X()({name:"VRadioGroup",inheritAttrs:!1,props:ze(),emits:{"update:modelValue":s=>!0},setup(s,m){let{attrs:p,slots:i}=m;const R=ne(),I=ue(()=>s.id||`radio-group-${R}`),o=ie(s,"modelValue");return Y(()=>{const[U,S]=re(p),c=M.filterProps(s),A=q.filterProps(s),_=i.label?i.label({label:s.label,props:{for:I.value}}):s.label;return e(M,H({class:["v-radio-group",s.class],style:s.style},U,c,{modelValue:o.value,"onUpdate:modelValue":f=>o.value=f,id:I.value}),{...i,default:f=>{let{id:C,messagesId:P,isDisabled:k,isReadonly:x}=f;return e(Z,null,[_&&e(de,{id:C.value},{default:()=>[_]}),e(he,H(A,{id:C.value,"aria-describedby":P.value,defaultsTarget:"VRadio",trueIcon:s.trueIcon,falseIcon:s.falseIcon,type:s.type,disabled:k.value,readonly:x.value,"aria-labelledby":_?C.value:void 0,multiple:!1},S,{modelValue:o.value,"onUpdate:modelValue":v=>o.value=v}),i)])}})}),{}}}),Ue=s=>(be("data-v-7fb86804"),s=s(),_e(),s),Ae=Ue(()=>ke("h2",{class:"text-center"}," 收件匣 ",-1)),ee={__name:"contact",setup(s){const{apiAuth:m}=ye(),p=pe(),i=d({open:!1,item:null}),R=r=>{i.value.item=r,i.value.open=!0},I=()=>{i.value.open=!1,i.value.item=null},o=d({open:!1,item:null,status:""}),U=r=>{o.value.item=r,o.value.status=r.status,o.value.open=!0},S=()=>{o.value.open=!1,o.value.item=null,o.value.status=""},c=d({open:!1,item:null}),A=r=>{c.value.item=r,c.value.open=!0},_=()=>{c.value.open=!1,c.value.item=null},f=d(!1),C=async()=>{var r,l;if(c.value.item)try{f.value=!0,await m.delete(`/contact/${c.value.item._id}`),p({text:"聯絡表單已成功刪除",snackbarProps:{color:"success"}}),_(),g(!0)}catch(n){console.log(n),p({text:((l=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:l.message)||"刪除失敗",snackbarProps:{color:"error"}})}finally{f.value=!1}},P=d(10),k=d([{key:"createdAt",order:"desc"}]),x=d(1),v=d([]),te=[{title:"姓名",align:"left",sortable:!0,key:"name",width:"110"},{title:"信箱",align:"left",sortable:!0,key:"email",width:"170"},{title:"主旨",align:"left",sortable:!0,key:"subject",width:"170"},{title:"內容",align:"left",sortable:!1,key:"content",width:"150"},{title:"狀態",align:"left",sortable:!0,key:"status",width:"150"},{title:"操作",align:"center",sortable:!1,key:"action",width:"100"}],B=d(!0),E=d(0),D=d(""),g=async r=>{var l,n,t,V;r&&(x.value=1),B.value=!0;try{const{data:y}=await m.get("/contact",{params:{page:x.value,itemsPerPage:P.value,sortBy:((l=k.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((n=k.value[0])==null?void 0:n.order)||"desc",search:D.value}});v.value.splice(0,v.value.length,...y.result.data),E.value=y.result.total}catch(y){console.log(y),p({text:((V=(t=y==null?void 0:y.response)==null?void 0:t.data)==null?void 0:V.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}B.value=!1},L=d(!1),ae=async()=>{var r,l;if(o.value.item)try{L.value=!0;const{data:n}=await m.patch(`/contact/${o.value.item._id}/status`,{status:o.value.status}),t=v.value.findIndex(V=>V._id===o.value.item._id);t!==-1&&(v.value[t].status=n.result.status),p({text:"狀態更新成功",snackbarProps:{color:"teal-darken-1"}}),S()}catch(n){console.log(n),p({text:((l=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{L.value=!1}},le=r=>{switch(r){case"待處理":return"warning";case"處理中":return"info";case"已完成":return"success";default:return"grey"}};return g(),(r,l)=>{const n=me("v-list-item-text");return fe(),ve(Z,null,[e(xe,null,{default:a(()=>[e(Ce,null,{default:a(()=>[e(j,{cols:"12"},{default:a(()=>[Ae]),_:1}),e(j,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:a(()=>[e(h),e(ge,{modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=t=>D.value=t),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240","onClick:append":l[1]||(l[1]=t=>g(!0)),onKeydown:l[2]||(l[2]=Ve(t=>g(!0),["enter"]))},null,8,["modelValue"])]),_:1}),e(j,{cols:"12"},{default:a(()=>[e(Pe,{"items-per-page":P.value,"onUpdate:itemsPerPage":[l[3]||(l[3]=t=>P.value=t),l[6]||(l[6]=t=>g(!1))],"sort-by":k.value,"onUpdate:sortBy":[l[4]||(l[4]=t=>k.value=t),l[7]||(l[7]=t=>g(!1))],page:x.value,"onUpdate:page":[l[5]||(l[5]=t=>x.value=t),l[8]||(l[8]=t=>g(!1))],"items-per-page-options":[10,20,50],items:v.value,headers:te,loading:B.value,"items-length":E.value,search:D.value,hover:""},{top:a(()=>[]),"item.status":a(({item:t})=>[e(we,{color:le(t.status),onClick:V=>U(t)},{default:a(()=>[u(w(t.status),1)]),_:2},1032,["color","onClick"])]),"item.content":a(({item:t})=>[e(b,{class:"view-btn",icon:"mdi-eye",size:"small",variant:"plain",onClick:V=>R(t)},null,8,["onClick"])]),"item.action":a(({item:t})=>[e(b,{class:"delete-btn",color:"red-darken-1",icon:"mdi-delete",size:"small",variant:"plain",onClick:V=>A(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),e(T,{modelValue:i.value.open,"onUpdate:modelValue":l[9]||(l[9]=t=>i.value.open=t),width:"520"},{default:a(()=>[e(G,{class:"rounded-xl py-4 px-8 pt-6"},{default:a(()=>[e(O,{style:{"font-size":"18px"}},{default:a(()=>[u(" 查看完整信件 ")]),_:1}),e(N,{class:"mt-3 pa-0"},{default:a(()=>[e(Ie,null,{default:a(()=>[e($,null,{default:a(()=>[e(z,{class:"card-title"},{default:a(()=>[u(" 姓名 ")]),_:1}),e(n,{class:"card-text"},{default:a(()=>{var t;return[u(w((t=i.value.item)==null?void 0:t.name),1)]}),_:1})]),_:1}),e($,null,{default:a(()=>[e(z,{class:"card-title"},{default:a(()=>[u(" 信箱 ")]),_:1}),e(n,{class:"card-text"},{default:a(()=>{var t;return[u(w((t=i.value.item)==null?void 0:t.email),1)]}),_:1})]),_:1}),e($,null,{default:a(()=>[e(z,{class:"card-title"},{default:a(()=>[u(" 主旨 ")]),_:1}),e(n,{class:"card-text"},{default:a(()=>{var t;return[u(w((t=i.value.item)==null?void 0:t.subject),1)]}),_:1})]),_:1}),e($,null,{default:a(()=>[e(z,{class:"card-title"},{default:a(()=>[u(" 內容 ")]),_:1}),e(n,{class:"card-text"},{default:a(()=>{var t;return[u(w((t=i.value.item)==null?void 0:t.content),1)]}),_:1})]),_:1})]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(h),e(b,{color:"primary",variant:"outlined",onClick:I},{default:a(()=>[u(" 關閉 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(T,{modelValue:o.value.open,"onUpdate:modelValue":l[11]||(l[11]=t=>o.value.open=t),width:"400"},{default:a(()=>[e(G,{class:"rounded-xl pa-4 pt-6"},{default:a(()=>[e(O,{style:{"font-size":"16px"}},{default:a(()=>[u(" 更新狀態 ")]),_:1}),e(N,{class:"mt-3 pa-3"},{default:a(()=>[e(Re,{modelValue:o.value.status,"onUpdate:modelValue":l[10]||(l[10]=t=>o.value.status=t)},{default:a(()=>[e(K,{label:"待處理",value:"待處理",style:{"font-size":"14px"}}),e(K,{label:"處理中",value:"處理中",style:{"font-size":"14px"}}),e(K,{label:"已完成",value:"已完成",style:{"font-size":"14px"}})]),_:1},8,["modelValue"])]),_:1}),e(F,null,{default:a(()=>[e(h),e(b,{color:"red-lighten-1",size:"small",variant:"outlined",onClick:S},{default:a(()=>[u(" 取消 ")]),_:1}),e(b,{color:"teal-darken-1",size:"small",variant:"outlined",loading:L.value,onClick:ae},{default:a(()=>[u(" 更新 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(T,{modelValue:c.value.open,"onUpdate:modelValue":l[12]||(l[12]=t=>c.value.open=t),width:"350"},{default:a(()=>[e(G,{class:"rounded-lg pa-4"},{default:a(()=>[e(O,{style:{"font-size":"16px"}},{default:a(()=>[u(" 確認刪除 ")]),_:1}),e(N,{class:"mt-3 pa-4",style:{"font-size":"14px"}},{default:a(()=>[u(" 您確定要刪除此信件嗎？此操作無法撤銷。 ")]),_:1}),e(F,null,{default:a(()=>[e(h),e(b,{color:"grey",size:"small",variant:"outlined",onClick:_},{default:a(()=>[u(" 取消 ")]),_:1}),e(b,{color:"error",size:"small",variant:"outlined",loading:f.value,onClick:C},{default:a(()=>[u(" 刪除 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};typeof Q=="function"&&Q(ee);const Me=ce(ee,[["__scopeId","data-v-7fb86804"]]);export{Me as default};
