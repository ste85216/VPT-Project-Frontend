import{_ as se,r as i,i as ne,o as M,b as re,d as l,w as o,B as E,F as ie,C as K,I as m,g as u,ax as F,aK as g,aL as ue,e as s,aM as de,q as j,x as H,t as pe,A as O,n as R,z as G,aN as J,p as me,h as ce,j as ve}from"./index-AexevADK.js";import{v as T}from"./index-DcBOdE6S.js";import{c as ge,a as S,u as fe,b as $}from"./vee-validate.esm-B7hSOMIu.js";import{b as Q}from"./route-block-B_A1xBdJ.js";import{V as be}from"./VContainer-RS8dmE6j.js";import{V as Ve,a as _}from"./VRow-Xe-l9eDu.js";import{V as ye}from"./VDataTableServer-S8JqwboP.js";import{V as ke}from"./VForm-qhDY1q54.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-BYWWILSq.js";import"./VPagination-B1VEVVsb.js";import"./VSelect-CZ86eOd9.js";import"./VList-C8hX6xg7.js";import"./VDivider-Bj1fYcnR.js";import"./VCheckboxBtn-CthZaanK.js";import"./VChip-B7qswl1N.js";import"./filter-B1cX8vvH.js";const xe=f=>(me("data-v-deb9c1d1"),f=f(),ce(),f),we=xe(()=>ve("h2",{class:"text-center"}," 管理者 ",-1)),W={__name:"administrator",setup(f){const b=i(!1),{apiAuth:I}=K(),{api:X}=K(),v=ne(),n=i({open:!1,id:""}),V=i({open:!1}),q=t=>{t?(n.value.id=t._id,y.value.value=t.account,x.value.value=t.email,w.value.value=t.phone,k.value.value=t.password):n.value.id="",n.value.open=!0},U=()=>{n.value.open=!1,ae()},Y=()=>{V.value.open=!0},N=()=>{V.value.open=!1},Z=ge({account:S().required("請輸入帳號").min(4,"帳號至少需輸入8個字").max(20,"帳號長度不得超過20個字").test("isAlphanumeric","帳號只能輸入英數字",t=>T.isAlphanumeric(t)),password:S().required("請輸入密碼").min(8,"密碼至少需輸入8個字"),email:S().required("請輸入信箱").test("isEmail","請輸入正確的信箱格式",t=>T.isEmail(t)),phone:S().required("請輸入手機號碼").min(10,"請輸入10碼手機號碼").test("isMobilePhone","請輸入正確的手機號碼格式",t=>T.isMobilePhone(t))}),{handleSubmit:ee,isSubmitting:c,resetForm:ae}=fe({validationSchema:Z,initialValues:{account:"",email:"",phone:"",password:""}}),y=$("account"),k=$("password"),x=$("email"),w=$("phone"),le=ee(async t=>{var e,a;try{const r={account:t.account,password:t.password,email:t.email,phone:t.phone,role:1};n.value.id===""?await X.post("/user",r):await I.patch("/user/"+n.value.id,r),console.log(t.birthday),v({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"teal-darken-1"}}),U(),d(!0)}catch(r){console.log(r),v({text:((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}}),A=i(10),h=i([{key:"createdAt",order:"desc"}]),C=i(1),B=i([]),te=[{title:"帳號",align:"left",sortable:!1,key:"account"},{title:"email",align:"left",sortable:!0,key:"email"},{title:"手機",align:"left",sortable:!0,key:"phone"},{title:"操作",align:"left",sortable:!1,key:"action"}],D=i(!0),L=i(0),P=i(""),d=async t=>{var e,a,r,z;t&&(C.value=1),D.value=!0;try{const{data:p}=await I.get("/user/all",{params:{page:C.value,itemsPerPage:A.value,sortBy:((e=h.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=h.value[0])==null?void 0:a.order)||"desc",search:P.value,role:1}});B.value.splice(0,B.value.length,...p.result.data),L.value=p.result.adminTotal}catch(p){console.log(p),v({text:((z=(r=p==null?void 0:p.response)==null?void 0:r.data)==null?void 0:z.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}D.value=!1};d();const oe=async()=>{var t,e;if(n.value.id)try{c.value=!0,await I.delete(`/user/${n.value.id}`),v({text:"刪除成功",snackbarProps:{color:"teal-darken-1"}}),U(),N(),d(!0)}catch(a){console.log(a),v({text:((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{c.value=!1}};return(t,e)=>(M(),re(ie,null,[l(be,null,{default:o(()=>[l(Ve,null,{default:o(()=>[l(_,{cols:"12"},{default:o(()=>[we]),_:1}),l(_,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:o(()=>[l(m,{class:"custom-btn",onClick:e[0]||(e[0]=a=>q(null))},{default:o(()=>[u(" 新增管理者 ")]),_:1}),l(F),l(g,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value=a),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240",onClickAppend:e[2]||(e[2]=a=>d(!0)),onKeydown:e[3]||(e[3]=ue(a=>d(!0),["enter"]))},null,8,["modelValue"])]),_:1}),l(_,{cols:"12"},{default:o(()=>[l(ye,{"items-per-page":A.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>A.value=a),e[7]||(e[7]=a=>d(!1))],"sort-by":h.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>h.value=a),e[8]||(e[8]=a=>d(!1))],page:C.value,"onUpdate:page":[e[6]||(e[6]=a=>C.value=a),e[9]||(e[9]=a=>d(!1))],"items-per-page-options":[10,20,50],items:B.value,headers:te,loading:D.value,"items-length":L.value,search:P.value,hover:""},{top:o(()=>[]),"item.action":o(({item:a})=>[l(m,{icon:"mdi-pencil",variant:"plain",class:"edit-btn",onClick:r=>q(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(E,{modelValue:n.value.open,"onUpdate:modelValue":e[15]||(e[15]=a=>n.value.open=a),persistent:"",width:"440"},{default:o(()=>[l(ke,{disabled:s(c),onSubmit:de(s(le),["prevent"])},{default:o(()=>[l(j,{class:"rounded-xl pa-4 pt-6"},{default:o(()=>[l(H,{style:{"font-size":"18px"}},{default:o(()=>[u(pe(n.value.id?"管理者資料編輯":"新增管理者"),1)]),_:1}),l(O,{class:"mt-3 pa-3"},{default:o(()=>[l(g,{modelValue:s(y).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>s(y).value.value=a),"error-messages":s(y).errorMessage.value,label:"帳號",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),l(g,{modelValue:s(x).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>s(x).value.value=a),"error-messages":s(x).errorMessage.value,class:"mt-2",label:"email",type:"email",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),l(g,{modelValue:s(w).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>s(w).value.value=a),"error-messages":s(w).errorMessage.value,class:"mt-2",label:"手機號碼",type:"text",variant:"outlined",density:"compact","min-length":"10",maxlength:"10",clearable:""},null,8,["modelValue","error-messages"]),n.value.id?G("",!0):(M(),R(g,{key:0,modelValue:s(k).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>s(k).value.value=a),"error-messages":s(k).errorMessage.value,class:"mt-2",label:"密碼",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:"",type:b.value?"text":"password","append-inner-icon":b.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[14]||(e[14]=a=>b.value=!b.value)},null,8,["modelValue","error-messages","type","append-inner-icon"]))]),_:1}),l(J,null,{default:o(()=>[n.value.id?(M(),R(m,{key:0,color:"red",loading:s(c),onClick:Y},{default:o(()=>[u(" 刪除 ")]),_:1},8,["loading"])):G("",!0),l(F),l(m,{color:"red",loading:s(c),onClick:U},{default:o(()=>[u(" 取消 ")]),_:1},8,["loading"]),l(m,{color:"green",type:"submit",loading:s(c)},{default:o(()=>[u(" 送出 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),l(E,{modelValue:V.value.open,"onUpdate:modelValue":e[16]||(e[16]=a=>V.value.open=a),"max-width":"320"},{default:o(()=>[l(j,{class:"px-4 py-3"},{default:o(()=>[l(H,{class:"headline",style:{"font-size":"18px"}},{default:o(()=>[u(" 確認刪除 ")]),_:1}),l(O,{class:"mt-3 pa-4"},{default:o(()=>[u(" 您確定要刪除此管理者嗎？此操作無法撤銷。 ")]),_:1}),l(J,null,{default:o(()=>[l(F),l(m,{color:"green darken-1",text:"",onClick:N},{default:o(()=>[u(" 取消 ")]),_:1}),l(m,{color:"red darken-1",text:"",onClick:oe},{default:o(()=>[u(" 刪除 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof Q=="function"&&Q(W);const ze=se(W,[["__scopeId","data-v-deb9c1d1"]]);export{ze as default};
