import{_ as ie,r as u,i as de,b as me,d as t,w as s,B as O,F as pe,C as R,o as L,I as c,g as i,ax as z,aK as p,aL as ce,e as o,aM as ve,q as Y,x as G,t as ge,A as J,n as Q,z as W,aN as X,p as fe,h as be,j as ye}from"./index-DA8F4u7b.js";import{v as A}from"./index-DcBOdE6S.js";import{c as Ve,a as v,u as ke,b as g}from"./vee-validate.esm-Ck7k4WEN.js";import{b as Z}from"./route-block-B_A1xBdJ.js";import{V as xe}from"./VContainer-BzpwGa1E.js";import{V as he,a as E}from"./VRow-CHq3eqsg.js";import{V as we}from"./VDataTableServer-caJyJhWv.js";import{V as Ce}from"./VForm-CgdjrSxy.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-CW_X9S_1.js";import"./VPagination-3UeXwAdF.js";import"./VSelect-CBgTls2F.js";import"./VList-DYDIJbtS.js";import"./VDivider-UtTXBzHr.js";import"./VCheckboxBtn-BAaphJx8.js";import"./VChip-DPzwU6Zt.js";import"./filter-CUlVJwML.js";const Se=y=>(fe("data-v-9d0fc00f"),y=y(),be(),y),Pe=Se(()=>ye("h2",{class:"text-center"}," 會員管理 ",-1)),_={__name:"member",setup(y){const V=u(!1),{apiAuth:B}=R(),{api:ee}=R(),b=de(),n=u({open:!1,id:""}),k=u({open:!1}),K=l=>{l?(n.value.id=l._id,x.value.value=l.account,w.value.value=l.name,C.value.value=l.nickname,S.value.value=l.email,P.value.value=l.phone,D.value.value=ae(l.birthday),h.value.value=l.password):n.value.id="",n.value.open=!0},ae=l=>{const e=new Date(l),a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),I=String(e.getDate()).padStart(2,"0");return`${a}-${r}-${I}`},q=()=>{n.value.open=!1,se()},le=()=>{k.value.open=!0},j=()=>{k.value.open=!1},te=Ve({account:v().required("請輸入帳號").min(4,"帳號至少需輸入8個字").max(20,"帳號長度不得超過20個字").test("isAlphanumeric","帳號只能輸入英數字",l=>A.isAlphanumeric(l)),password:v().required("請輸入密碼").min(8,"密碼至少需輸入8個字"),name:v().required("請輸入姓名"),nickname:v().required("請輸入暱稱"),email:v().required("請輸入信箱").test("isEmail","請輸入正確的信箱格式",l=>A.isEmail(l)),phone:v().required("請輸入手機號碼").min(10,"請輸入10碼手機號碼").test("isMobilePhone","請輸入正確的手機號碼格式",l=>A.isMobilePhone(l)),birthday:v().required("請輸入生日").test("isDate","請輸入正確的日期格式",l=>A.isDate(l))}),{handleSubmit:oe,isSubmitting:f,resetForm:se}=ke({validationSchema:te,initialValues:{account:"",name:"",nickname:"",email:"",phone:"",birthday:"",password:""}}),x=g("account"),h=g("password"),w=g("name"),C=g("nickname"),S=g("email"),P=g("phone"),D=g("birthday"),ne=oe(async l=>{var e,a;try{const r={account:l.account,password:l.password,name:l.name,nickname:l.nickname,email:l.email,phone:l.phone,birthday:new Date(l.birthday)};n.value.id===""?await ee.post("/user",r):await B.patch("/user/"+n.value.id,r),console.log(l.birthday),b({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"teal-darken-1"}}),q(),d(!0)}catch(r){console.log(r),b({text:((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}}),F=u(10),$=u([{key:"createdAt",order:"desc"}]),U=u(1),T=u([]),re=[{title:"帳號",align:"left",sortable:!1,key:"account"},{title:"姓名",align:"left",sortable:!0,key:"name"},{title:"暱稱",align:"left",sortable:!0,key:"nickname"},{title:"email",align:"left",sortable:!0,key:"email"},{title:"手機",align:"left",sortable:!0,key:"phone"},{title:"操作",align:"left",sortable:!1,key:"action"}],N=u(!0),H=u(0),M=u(""),d=async l=>{var e,a,r,I;l&&(U.value=1),N.value=!0;try{const{data:m}=await B.get("/user/all",{params:{page:U.value,itemsPerPage:F.value,sortBy:((e=$.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=$.value[0])==null?void 0:a.order)||"desc",search:M.value,role:0}});console.log(m),T.value.splice(0,T.value.length,...m.result.data),H.value=m.result.memberTotal}catch(m){console.log(m),b({text:((I=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:I.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}N.value=!1};d();const ue=async()=>{var l,e;if(n.value.id)try{f.value=!0,await B.delete(`/user/${n.value.id}`),b({text:"刪除成功",snackbarProps:{color:"teal-darken-1"}}),q(),j(),d(!0)}catch(a){console.log(a),b({text:((e=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{f.value=!1}};return(l,e)=>(L(),me(pe,null,[t(xe,null,{default:s(()=>[t(he,null,{default:s(()=>[t(E,{cols:"12"},{default:s(()=>[Pe]),_:1}),t(E,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:s(()=>[t(c,{class:"custom-btn",onClick:e[0]||(e[0]=a=>K(null))},{default:s(()=>[i(" 新增會員 ")]),_:1}),t(z),t(p,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=a=>M.value=a),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240",onClickAppend:e[2]||(e[2]=a=>d(!0)),onKeydown:e[3]||(e[3]=ce(a=>d(!0),["enter"]))},null,8,["modelValue"])]),_:1}),t(E,{cols:"12"},{default:s(()=>[t(we,{"items-per-page":F.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>F.value=a),e[7]||(e[7]=a=>d(!1))],"sort-by":$.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>$.value=a),e[8]||(e[8]=a=>d(!1))],page:U.value,"onUpdate:page":[e[6]||(e[6]=a=>U.value=a),e[9]||(e[9]=a=>d(!1))],"items-per-page-options":[10,20,50],items:T.value,headers:re,loading:N.value,"items-length":H.value,search:M.value,hover:""},{top:s(()=>[]),"item.action":s(({item:a})=>[t(c,{class:"edit-btn",icon:"mdi-pencil",variant:"plain",onClick:r=>K(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(O,{modelValue:n.value.open,"onUpdate:modelValue":e[18]||(e[18]=a=>n.value.open=a),persistent:"",width:"440"},{default:s(()=>[t(Ce,{disabled:o(f),onSubmit:ve(o(ne),["prevent"])},{default:s(()=>[t(Y,{class:"rounded-xl pa-4 pt-6"},{default:s(()=>[t(G,{style:{"font-size":"18px"}},{default:s(()=>[i(ge(n.value.id?"會員資料編輯":"新增會員"),1)]),_:1}),t(J,{class:"mt-3 pa-3"},{default:s(()=>[t(p,{modelValue:o(x).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>o(x).value.value=a),"error-messages":o(x).errorMessage.value,label:"帳號",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(w).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>o(w).value.value=a),"error-messages":o(w).errorMessage.value,class:"mt-2",label:"姓名",type:"text",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(C).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>o(C).value.value=a),"error-messages":o(C).errorMessage.value,class:"mt-2",label:"暱稱",type:"text",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(S).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o(S).value.value=a),"error-messages":o(S).errorMessage.value,class:"mt-2",label:"email",type:"email",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(P).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>o(P).value.value=a),"error-messages":o(P).errorMessage.value,class:"mt-2",label:"手機號碼",type:"text",variant:"outlined",density:"compact","min-length":"10",maxlength:"10",clearable:""},null,8,["modelValue","error-messages"]),t(p,{modelValue:o(D).value.value,"onUpdate:modelValue":e[15]||(e[15]=a=>o(D).value.value=a),"error-messages":o(D).errorMessage.value,class:"mt-2",label:"生日",type:"date",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),n.value.id?W("",!0):(L(),Q(p,{key:0,modelValue:o(h).value.value,"onUpdate:modelValue":e[16]||(e[16]=a=>o(h).value.value=a),"error-messages":o(h).errorMessage.value,class:"mt-2",label:"密碼",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:"",type:V.value?"text":"password","append-inner-icon":V.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[17]||(e[17]=a=>V.value=!V.value)},null,8,["modelValue","error-messages","type","append-inner-icon"]))]),_:1}),t(X,null,{default:s(()=>[n.value.id?(L(),Q(c,{key:0,color:"red",loading:o(f),onClick:le},{default:s(()=>[i(" 刪除 ")]),_:1},8,["loading"])):W("",!0),t(z),t(c,{color:"red",loading:o(f),onClick:q},{default:s(()=>[i(" 取消 ")]),_:1},8,["loading"]),t(c,{color:"green",type:"submit",loading:o(f)},{default:s(()=>[i(" 送出 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),t(O,{modelValue:k.value.open,"onUpdate:modelValue":e[19]||(e[19]=a=>k.value.open=a),"max-width":"320"},{default:s(()=>[t(Y,null,{default:s(()=>[t(G,{class:"headline",style:{"font-size":"18px"}},{default:s(()=>[i(" 確認刪除 ")]),_:1}),t(J,{class:"mt-3 pa-4"},{default:s(()=>[i(" 您確定要刪除此會員嗎？此操作無法撤銷。 ")]),_:1}),t(X,null,{default:s(()=>[t(z),t(c,{color:"green darken-1",text:"",onClick:j},{default:s(()=>[i(" 取消 ")]),_:1}),t(c,{color:"red darken-1",text:"",onClick:ue},{default:s(()=>[i(" 刪除 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof Z=="function"&&Z(_);const Oe=ie(_,[["__scopeId","data-v-9d0fc00f"]]);export{Oe as default};
