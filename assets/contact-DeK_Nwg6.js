import{E as X,H as Y,I as Z,d as t,m as H,aP as oe,aQ as ne,K as Q,aR as ue,c as ie,am as re,aS as de,aT as q,F as ee,aU as ce,_ as pe,i as me,r as i,o as fe,b as ve,w as a,C as O,ay as R,aL as ge,aM as Ve,g as d,t as h,J as b,s as L,y as F,B as N,h as p,aO as K,D as ye,p as be,k as _e}from"./index-Dl6LQXFh.js";import{b as W}from"./route-block-B_A1xBdJ.js";import{V as ke}from"./VContainer-Dv2e2o90.js";import{V as j,a as _}from"./VRow-CYq4dY3q.js";import{V as xe}from"./VDataTableServer-BFxut-5s.js";import{V as Ce}from"./VChip-DExWuyjM.js";import{m as Pe,V as M,a as we,b as he}from"./VCheckboxBtn-CJeeYMUz.js";import"./VDataTable-D8OoxUUk.js";import"./VPagination-1OITgKK1.js";import"./VSelect-Ch0fxMDl.js";import"./VList-CH2TLUSt.js";import"./VDivider-Cs6Zqrd2.js";import"./filter-CmVEm0zx.js";const Ie=X({...Pe({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),E=Y()({name:"VRadio",props:Ie(),setup(s,f){let{slots:c}=f;return Z(()=>{const n=M.filterProps(s);return t(M,H(n,{class:["v-radio",s.class],style:s.style,type:"radio"}),c)}),{}}}),Se=X({height:{type:[Number,String],default:"auto"},...oe(),...ne(we(),["multiple"]),trueIcon:{type:Q,default:"$radioOn"},falseIcon:{type:Q,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),De=Y()({name:"VRadioGroup",inheritAttrs:!1,props:Se(),emits:{"update:modelValue":s=>!0},setup(s,f){let{attrs:c,slots:n}=f;const U=ue(),S=ie(()=>s.id||`radio-group-${U}`),o=re(s,"modelValue");return Z(()=>{const[A,D]=de(c),r=q.filterProps(s),B=M.filterProps(s),k=n.label?n.label({label:s.label,props:{for:S.value}}):s.label;return t(q,H({class:["v-radio-group",s.class],style:s.style},A,r,{modelValue:o.value,"onUpdate:modelValue":v=>o.value=v,id:S.value}),{...n,default:v=>{let{id:P,messagesId:w,isDisabled:x,isReadonly:C}=v;return t(ee,null,[k&&t(ce,{id:P.value},{default:()=>[k]}),t(he,H(B,{id:P.value,"aria-describedby":w.value,defaultsTarget:"VRadio",trueIcon:s.trueIcon,falseIcon:s.falseIcon,type:s.type,disabled:x.value,readonly:C.value,"aria-labelledby":k?P.value:void 0,multiple:!1},D,{modelValue:o.value,"onUpdate:modelValue":g=>o.value=g}),n)])}})}),{}}}),I=s=>(be("data-v-7358d2d7"),s=s(),_e(),s),$e=I(()=>p("h2",{class:"text-center"}," 收件匣 ",-1)),ze=I(()=>p("p",{class:"card-title"}," 姓名 ",-1)),Re={class:"card-text"},Ue=I(()=>p("p",{class:"card-title"}," 信箱 ",-1)),Ae={class:"card-text"},Be=I(()=>p("p",{class:"card-title"}," 主旨 ",-1)),Te={class:"card-text"},Ge=I(()=>p("p",{class:"card-title"}," 內容 ",-1)),Oe={class:"card-text"},te={__name:"contact",setup(s){const{apiAuth:f}=ye(),c=me(),n=i({open:!1,item:null}),U=u=>{n.value.item=u,n.value.open=!0},S=()=>{n.value.open=!1,n.value.item=null},o=i({open:!1,item:null,status:""}),A=u=>{o.value.item=u,o.value.status=u.status,o.value.open=!0},D=()=>{o.value.open=!1,o.value.item=null,o.value.status=""},r=i({open:!1,item:null}),B=u=>{r.value.item=u,r.value.open=!0},k=()=>{r.value.open=!1,r.value.item=null},v=i(!1),P=async()=>{var u,l;if(r.value.item)try{v.value=!0,await f.delete(`/contact/${r.value.item._id}`),c({text:"聯絡表單已成功刪除",snackbarProps:{color:"success"}}),k(),V(!0)}catch(e){console.log(e),c({text:((l=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:l.message)||"刪除失敗",snackbarProps:{color:"error"}})}finally{v.value=!1}},w=i(10),x=i([{key:"createdAt",order:"desc"}]),C=i(1),g=i([]),ae=[{title:"姓名",align:"left",sortable:!0,key:"name",width:"110"},{title:"信箱",align:"left",sortable:!0,key:"email",width:"170"},{title:"主旨",align:"left",sortable:!0,key:"subject",width:"170"},{title:"內容",align:"left",sortable:!1,key:"content",width:"150"},{title:"狀態",align:"left",sortable:!0,key:"status",width:"150"},{title:"操作",align:"center",sortable:!1,key:"action",width:"100"}],T=i(!0),J=i(0),$=i(""),V=async u=>{var l,e,m,z;u&&(C.value=1),T.value=!0;try{const{data:y}=await f.get("/contact",{params:{page:C.value,itemsPerPage:w.value,sortBy:((l=x.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((e=x.value[0])==null?void 0:e.order)||"desc",search:$.value}});g.value.splice(0,g.value.length,...y.result.data),J.value=y.result.total}catch(y){console.log(y),c({text:((z=(m=y==null?void 0:y.response)==null?void 0:m.data)==null?void 0:z.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}T.value=!1},G=i(!1),le=async()=>{var u,l;if(o.value.item)try{G.value=!0;const{data:e}=await f.patch(`/contact/${o.value.item._id}/status`,{status:o.value.status}),m=g.value.findIndex(z=>z._id===o.value.item._id);m!==-1&&(g.value[m].status=e.result.status),c({text:"狀態更新成功",snackbarProps:{color:"teal-darken-1"}}),D()}catch(e){console.log(e),c({text:((l=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{G.value=!1}},se=u=>{switch(u){case"待處理":return"warning";case"處理中":return"info";case"已完成":return"success";default:return"grey"}};return V(),(u,l)=>(fe(),ve(ee,null,[t(ke,null,{default:a(()=>[t(j,null,{default:a(()=>[t(_,{cols:"12"},{default:a(()=>[$e]),_:1}),t(_,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:a(()=>[t(R),t(ge,{modelValue:$.value,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value=e),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240","onClick:append":l[1]||(l[1]=e=>V(!0)),onKeydown:l[2]||(l[2]=Ve(e=>V(!0),["enter"]))},null,8,["modelValue"])]),_:1}),t(_,{cols:"12"},{default:a(()=>[t(xe,{"items-per-page":w.value,"onUpdate:itemsPerPage":[l[3]||(l[3]=e=>w.value=e),l[6]||(l[6]=e=>V(!1))],"sort-by":x.value,"onUpdate:sortBy":[l[4]||(l[4]=e=>x.value=e),l[7]||(l[7]=e=>V(!1))],page:C.value,"onUpdate:page":[l[5]||(l[5]=e=>C.value=e),l[8]||(l[8]=e=>V(!1))],"items-per-page-options":[10,20,50],items:g.value,headers:ae,loading:T.value,"items-length":J.value,search:$.value,hover:""},{top:a(()=>[]),"item.status":a(({item:e})=>[t(Ce,{color:se(e.status),onClick:m=>A(e)},{default:a(()=>[d(h(e.status),1)]),_:2},1032,["color","onClick"])]),"item.content":a(({item:e})=>[t(b,{class:"view-btn",icon:"mdi-eye",size:"small",variant:"plain",onClick:m=>U(e)},null,8,["onClick"])]),"item.action":a(({item:e})=>[t(b,{class:"delete-btn",color:"red-darken-1",icon:"mdi-delete",size:"small",variant:"plain",onClick:m=>B(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(O,{modelValue:n.value.open,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.open=e),width:"520"},{default:a(()=>[t(L,{class:"rounded-xl py-4 px-8 pt-6"},{default:a(()=>[t(F,{style:{"font-size":"18px"}},{default:a(()=>[d(" 查看完整信件 ")]),_:1}),t(N,{class:"mt-3 ps-4"},{default:a(()=>[t(j,null,{default:a(()=>[t(_,{cols:"12"},{default:a(()=>{var e;return[ze,p("p",Re,h((e=n.value.item)==null?void 0:e.name),1)]}),_:1}),t(_,{cols:"12"},{default:a(()=>{var e;return[Ue,p("p",Ae,h((e=n.value.item)==null?void 0:e.email),1)]}),_:1})]),_:1}),t(j,null,{default:a(()=>[t(_,{cols:"12"},{default:a(()=>{var e;return[Be,p("p",Te,h((e=n.value.item)==null?void 0:e.subject),1)]}),_:1}),t(_,{cols:"12"},{default:a(()=>{var e;return[Ge,p("p",Oe,h((e=n.value.item)==null?void 0:e.content),1)]}),_:1})]),_:1})]),_:1}),t(K,null,{default:a(()=>[t(R),t(b,{color:"primary",variant:"outlined",onClick:S},{default:a(()=>[d(" 關閉 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:o.value.open,"onUpdate:modelValue":l[11]||(l[11]=e=>o.value.open=e),width:"400"},{default:a(()=>[t(L,{class:"rounded-xl pa-4 pt-6"},{default:a(()=>[t(F,{style:{"font-size":"16px"}},{default:a(()=>[d(" 更新狀態 ")]),_:1}),t(N,{class:"mt-3 pa-3"},{default:a(()=>[t(De,{modelValue:o.value.status,"onUpdate:modelValue":l[10]||(l[10]=e=>o.value.status=e)},{default:a(()=>[t(E,{label:"待處理",value:"待處理",style:{"font-size":"14px"}}),t(E,{label:"處理中",value:"處理中",style:{"font-size":"14px"}}),t(E,{label:"已完成",value:"已完成",style:{"font-size":"14px"}})]),_:1},8,["modelValue"])]),_:1}),t(K,null,{default:a(()=>[t(R),t(b,{color:"red-lighten-1",size:"small",variant:"outlined",onClick:D},{default:a(()=>[d(" 取消 ")]),_:1}),t(b,{color:"teal-darken-1",size:"small",variant:"outlined",loading:G.value,onClick:le},{default:a(()=>[d(" 更新 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:r.value.open,"onUpdate:modelValue":l[12]||(l[12]=e=>r.value.open=e),width:"350"},{default:a(()=>[t(L,{class:"rounded-lg pa-4"},{default:a(()=>[t(F,{style:{"font-size":"16px"}},{default:a(()=>[d(" 確認刪除 ")]),_:1}),t(N,{class:"mt-3 pa-4",style:{"font-size":"14px"}},{default:a(()=>[d(" 您確定要刪除此信件嗎？此操作無法撤銷。 ")]),_:1}),t(K,null,{default:a(()=>[t(R),t(b,{color:"grey",size:"small",variant:"outlined",onClick:k},{default:a(()=>[d(" 取消 ")]),_:1}),t(b,{color:"error",size:"small",variant:"outlined",loading:v.value,onClick:P},{default:a(()=>[d(" 刪除 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof W=="function"&&W(te);const Ye=pe(te,[["__scopeId","data-v-7358d2d7"]]);export{Ye as default};
