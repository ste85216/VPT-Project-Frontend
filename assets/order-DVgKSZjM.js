import{_ as F,i as N,r,n as T,o as V,q as L,w as a,d as t,ay as E,aL as I,aM as K,h as w,g as n,b as M,f as H,F as O,D as R,v as j,t as u,p as G,k as J}from"./index-JmLPZ0ix.js";import{b as P}from"./route-block-B_A1xBdJ.js";import{V as Q}from"./VContainer-HFwRaMIR.js";import{a as s,V as k}from"./VRow-BS-lAv8L.js";import{V as W}from"./VDataTable-BcXxnbGH.js";import{V as X,a as B}from"./VList-CxC1Ni2m.js";import"./VPagination-DmVwG4n5.js";import"./VSelect-BDGKLtES.js";import"./VCheckboxBtn-BgChJEWi.js";import"./VChip-Ba9iiG22.js";import"./filter-B0LuyzFP.js";import"./VDivider-BSVDpMZq.js";const Y=p=>(G("data-v-1d4e0938"),p=p(),J(),p),Z=Y(()=>w("h2",{class:"text-center"}," 訂單管理 ",-1)),ee=["colspan"],$={__name:"order",setup(p){const{apiAuth:D}=R(),U=N(),b=r(10),c=r([{key:"createdAt",order:"desc"}]),f=r(1),g=r([]),q=[{title:"訂單編號",align:"left",sortable:!0,key:"_id"},{title:"會員編號",align:"left",sortable:!0,key:"user.account"},{title:"訂單日期",align:"left",sortable:!0,key:"createdAt"},{title:"訂單總額",align:"left",sortable:!1,key:"total"},{title:"訂單備註",align:"left",sortable:!1,key:"note"},{title:"",key:"data-table-expand"}],x=r(!0),h=r(0),m=r(""),S=r([]),i=async v=>{var e,l,y,o;v&&(f.value=1),x.value=!0;try{const{data:d}=await D.get("/order/all",{params:{page:f.value,itemsPerPage:b.value,sortBy:((e=c.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((l=c.value[0])==null?void 0:l.order)||"desc",search:m.value}});g.value.splice(0,g.value.length,...d.result),h.value=d.result.length,g.value.forEach(_=>{_.total=_.cart.reduce((C,A)=>C+A.p_id.price*A.quantity,0),_.createdAt=z(_.createdAt)})}catch(d){console.log(d),U({text:((o=(y=d==null?void 0:d.response)==null?void 0:y.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}x.value=!1},z=v=>{const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(v).toLocaleDateString(void 0,e)};return T(()=>{i()}),(v,e)=>(V(),L(Q,null,{default:a(()=>[t(k,null,{default:a(()=>[t(s,{cols:"12"},{default:a(()=>[Z]),_:1}),t(s,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:a(()=>[t(E),t(I,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240",clearable:"",onClickAppend:e[1]||(e[1]=l=>i(!0)),onKeydown:e[2]||(e[2]=K(l=>i(!0),["enter"]))},null,8,["modelValue"])]),_:1}),t(s,{cols:"12"},{default:a(()=>[t(W,{expanded:S.value,"onUpdate:expanded":e[3]||(e[3]=l=>S.value=l),"items-per-page":b.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=l=>b.value=l),e[7]||(e[7]=l=>i(!1))],"sort-by":c.value,"onUpdate:sortBy":[e[5]||(e[5]=l=>c.value=l),e[8]||(e[8]=l=>i(!1))],page:f.value,"onUpdate:page":[e[6]||(e[6]=l=>f.value=l),e[9]||(e[9]=l=>i(!1))],"item-value":"_id","items-per-page-options":[5,10,20],items:g.value,headers:q,loading:x.value,"items-length":h.value,search:m.value,"show-expand":"",hover:""},{"expanded-row":a(({columns:l,item:y})=>[w("tr",null,[w("td",{colspan:l.length},[t(X,null,{default:a(()=>[t(B,{class:"mb-3 opacity-90",style:{"font-size":"12px"}},{default:a(()=>[t(k,{style:{"font-size":"14px","font-weight":"500"},class:"text-center"},{default:a(()=>[t(s,{cols:"2"},{default:a(()=>[n(" 商品縮圖 ")]),_:1}),t(s,{cols:"2"},{default:a(()=>[n(" 商品名稱 ")]),_:1}),t(s,{cols:"2"},{default:a(()=>[n(" 商品規格 ")]),_:1}),t(s,{cols:"2"},{default:a(()=>[n(" 商品價格 ")]),_:1}),t(s,{cols:"2"},{default:a(()=>[n(" 商品數量 ")]),_:1}),t(s,{cols:"2"},{default:a(()=>[n(" 商品小計 ")]),_:1})]),_:1})]),_:1}),(V(!0),M(O,null,H(y.cart,o=>(V(),L(B,{key:o.p_id._id},{default:a(()=>[t(k,{style:{"font-size":"14px"},class:"text-center"},{default:a(()=>[t(s,{cols:"2"},{default:a(()=>[t(j,{src:o.p_id.images[0],height:"50"},null,8,["src"])]),_:2},1024),t(s,{cols:"2",class:"align-self-center"},{default:a(()=>[n(u(o.p_id.name),1)]),_:2},1024),t(s,{cols:"2",class:"align-self-center"},{default:a(()=>[n(u(o.colors)+" / "+u(o.sizes),1)]),_:2},1024),t(s,{cols:"2",class:"align-self-center"},{default:a(()=>[n(" $"+u(o.p_id.price),1)]),_:2},1024),t(s,{cols:"2",class:"align-self-center"},{default:a(()=>[n(u(o.quantity),1)]),_:2},1024),t(s,{cols:"2",class:"align-self-center"},{default:a(()=>[n(" $"+u(o.p_id.price*o.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],8,ee)])]),_:1},8,["expanded","items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}))}};typeof P=="function"&&P($);const fe=F($,[["__scopeId","data-v-1d4e0938"]]);export{fe as default};
