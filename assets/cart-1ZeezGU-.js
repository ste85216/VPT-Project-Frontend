import{_ as T,bg as R,u as E,i as J,r as h,c as M,b as $,d as e,w as t,F as N,o as b,n as S,q as V,z as Q,f as G,j as m,t as y,I as k,g as H,C as O,s as W,V as j,aJ as X,aK as Y,p as Z,h as ee}from"./index-BYEAN4sm.js";import{C as ae}from"./ConfirmDeleteDialog-CFNPq2DY.js";import{V as te}from"./VContainer-CofdrKV5.js";import{V as p,a as n}from"./VRow-DZHmcDMg.js";import{V as se}from"./VTextarea-BwSiSIui.js";const q=g=>(Z("data-v-077ea030"),g=g(),ee(),g),le=q(()=>m("h2",{class:"mb-5"}," 購物車 ",-1)),ne=q(()=>m("div",{class:"text-gray"}," 購物車內尚未加入商品 ",-1)),oe={class:"card-text"},ce={class:"card-text"},ue=q(()=>m("h4",{class:"note-title"}," 訂單備註 ",-1)),ie=q(()=>m("h4",{class:"total-price-title"}," 結帳金額 ",-1)),re={class:"total-price"},de={__name:"cart",setup(g){const{apiAuth:A}=O(),v=R(),d=E(),x=J(),r=h([]),f=h(!1),w=h(""),u=h({open:!1}),P=async()=>{var a,l;try{const{data:s}=await A.get("/user/cart"),o=s.result.filter(c=>c.p_id&&c.p_id.sell),i=s.result.filter(c=>!c.p_id||!c.p_id.sell);for(const c of i)await B(c,!1);r.value=o.sort((c,C)=>new Date(C.createdAt)-new Date(c.createdAt)),d.cart=o}catch(s){x({text:((l=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}},I=async a=>{(!a.quantity||a.quantity<1)&&(a.quantity=1),await _(a,a.quantity)},U=a=>{(isNaN(a.quantity)||a.quantity===null||a.quantity==="")&&(a.quantity=1)},z=async(a,l)=>{if(!d.isLogin){v.push("/login");return}if(l<1){u.value={open:!0,title:"您確認要移除嗎？",message:"",action:()=>_(a,0)};return}a.quantity=l,await _(a,l)},B=async(a,l=!0)=>{if(!d.isLogin){v.push("/login");return}l?u.value={open:!0,title:"您確認要移除嗎？",message:"",action:()=>_(a,0)}:await _(a,0)},K=async()=>{u.value.action&&await u.value.action(),D()},D=()=>{u.value.open=!1,u.value.action=null},_=async(a,l=null)=>{var s,o;if(!d.isLogin){v.push("/login");return}try{f.value=!0;const i=l!==null?l:a.quantity,c=await d.addCart(a.p_id._id,i,a.colors,a.sizes);c.color==="green"?(i===0?r.value=r.value.filter(C=>C._id!==a._id):a.quantity=i,d.cart=r.value.slice()):x({text:c.text,snackbarProps:{color:c.color}}),f.value=!1}catch(i){f.value=!1,console.log(i),x({text:((o=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}},L=M(()=>r.value.reduce((a,l)=>a+l.p_id.price*l.quantity,0)),F=async()=>{f.value=!0;const a=await d.checkout(w.value);console.log(a),x({text:a.text,snackbarProps:{color:a.color}}),a.color==="teal-darken-1"&&(v.push("/member/order"),f.value=!1)};return P(),(a,l)=>(b(),$(N,null,[e(te,{class:"px-4 px-lg-0 py-0 mt-10 h-75",style:{"max-width":"1200px"}},{default:t(()=>[le,e(p,null,{default:t(()=>[e(n,{cols:"12",sm:"7",md:"8"},{default:t(()=>[r.value.length===0?(b(),S(V,{key:0,class:"mb-4 cart-card d-flex justify-center align-center"},{default:t(()=>[ne]),_:1})):Q("",!0),(b(!0),$(N,null,G(r.value,s=>(b(),S(V,{key:s._id,class:"mb-4 cart-card py-4 ps-4 pe-5"},{default:t(()=>[e(p,{"no-gutters":"",class:"d-flex justify-space-between"},{default:t(()=>[e(n,{cols:"4",md:"2",class:"d-flex align-center justify-center"},{default:t(()=>[e(W,{src:s.p_id.images[0],elevation:"0",height:"80",width:"80"},null,8,["src"])]),_:2},1024),e(n,{cols:"6",md:"9",class:"d-flex flex-column justify-center"},{default:t(()=>[e(p,{"no-gutters":""},{default:t(()=>[e(n,{cols:"12",md:"",class:"d-flex flex-column justify-center text-sm-center px-md-2"},{default:t(()=>[m("div",oe,y(s.p_id.name)+" / "+y(s.p_id.price)+" 元 ",1)]),_:2},1024),e(n,{cols:"12",md:"",class:"d-flex align-center justify-sm-center ps-md-2"},{default:t(()=>[m("div",ce,y(s.colors)+" / "+y(s.sizes),1)]),_:2},1024),e(n,{cols:"12",md:"4",class:"d-flex align-sm-center justify-sm-center"},{default:t(()=>[e(p,{"no-gutters":"",class:"d-flex align-sm-center justify-sm-center"},{default:t(()=>[e(n,{cols:"1",sm:"2",md:"4",class:"d-flex align-center justify-center me-3 me-md-0"},{default:t(()=>[e(k,{icon:"",size:"x-small",elevation:"0",class:"quantity-btn",onClick:o=>z(s,s.quantity-1)},{default:t(()=>[e(j,{icon:"mdi-minus",size:"small",class:"minus-btn"})]),_:2},1032,["onClick"])]),_:2},1024),e(n,{cols:"3",sm:"4",class:"d-flex align-center me-3 me-md-0"},{default:t(()=>[e(X,{modelValue:s.quantity,"onUpdate:modelValue":o=>s.quantity=o,modelModifiers:{number:!0},type:"number",min:"1",variant:"outlined",density:"compact",class:"quantity-input",onInput:o=>U(s),onBlur:o=>I(s),onKeypress:Y(o=>I(s),["enter"])},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur","onKeypress"])]),_:2},1024),e(n,{cols:"1",sm:"2",md:"4",class:"d-flex align-center justify-center"},{default:t(()=>[e(k,{icon:"",size:"x-small",elevation:"0",class:"quantity-btn",onClick:o=>z(s,s.quantity+1)},{default:t(()=>[e(j,{icon:"mdi-plus",size:"small",class:"plus-btn"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(n,{cols:"1",md:"1",class:"d-flex align-center justify-center"},{default:t(()=>[e(k,{icon:"",class:"delete-btn",ripple:!1,variant:"plain",onClick:o=>B(s)},{default:t(()=>[e(j,{icon:"mdi-delete",color:"red-darken-3",class:"pb-2"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(n,{cols:"12",sm:"5",md:"4"},{default:t(()=>[e(V,{class:"pa-4 pb-0 cart-card mb-4",height:"160"},{default:t(()=>[e(p,null,{default:t(()=>[e(n,{cols:"12",class:"pb-0"},{default:t(()=>[ue]),_:1})]),_:1}),e(p,null,{default:t(()=>[e(n,{class:"pt-4"},{default:t(()=>[e(se,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=s=>w.value=s),rows:"2",variant:"outlined","auto-grow":"","base-color":"#666","hide-details":"","no-resize":"","max-rows":"2",disabled:f.value||r.value.length===0},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(V,{class:"pa-4 pb-0 cart-card",height:"150"},{default:t(()=>[e(p,{class:"d-flex flex-column h-100"},{default:t(()=>[e(n,{class:"d-flex justify-space-between"},{default:t(()=>[ie,m("div",re," $"+y(L.value),1)]),_:1}),e(n,{class:"pb-0"},{default:t(()=>[e(k,{color:"primary",class:"checkout-btn",disabled:f.value||r.value.length===0,onClick:F},{default:t(()=>[H(" 結帳 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{modelValue:u.value.open,"onUpdate:modelValue":l[1]||(l[1]=s=>u.value.open=s),title:u.value.title,message:u.value.message,"cancel-size":"small","confirm-size":"small",onConfirm:K,onCancel:D},null,8,["modelValue","title","message"])],64))}},ge=T(de,[["__scopeId","data-v-077ea030"]]);export{ge as default};
