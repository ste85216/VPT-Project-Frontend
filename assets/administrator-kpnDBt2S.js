import{_ as ne,r as i,i as re,o as N,b as ie,d as l,w as t,C as K,F as ue,D as H,J as m,g as u,ay as T,aL as b,aM as de,e as s,aN as pe,s as J,y as R,t as me,B as j,q as G,A as Q,aO as W,p as ce,k as ve,h as ge}from"./index-DLzcBzPq.js";import{v as _}from"./index-DcBOdE6S.js";import{c as fe,a as f,u as be,b as $}from"./vee-validate.esm-D9zB_Jy6.js";import{b as X}from"./route-block-B_A1xBdJ.js";import{V as ye}from"./VContainer-BaBWyiTw.js";import{V as Ve,a as q}from"./VRow-BdLZM5iY.js";import{V as ke}from"./VDataTableServer-DODE-2DC.js";import{V as xe}from"./VForm-BJrOCbKT.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-D5M8KgWD.js";import"./VPagination-BEksbxSR.js";import"./VSelect-CzR4mgRG.js";import"./VList-CZyWY9aU.js";import"./VDivider-BJ7BNYmW.js";import"./VCheckboxBtn-BB-CDoIM.js";import"./VChip-DSPQgcSm.js";import"./filter-Ciwcd0po.js";const we=y=>(ce("data-v-433eaa61"),y=y(),ve(),y),he=we(()=>ge("h2",{class:"text-center"}," 管理者 ",-1)),Y={__name:"administrator",setup(y){const V=i(!1),A=i(!1),{apiAuth:U}=H(),{api:Z}=H(),c=re(),n=i({open:!1,id:""}),k=i({open:!1}),E=o=>{o?(A.value=!0,n.value.id=o._id,x.value.value=o.account,w.value.value=o.email,h.value.value=o.phone):(A.value=!1,n.value.id="",O()),n.value.open=!0},B=()=>{n.value.open=!1,O()},ee=()=>{k.value.open=!0},L=()=>{k.value.open=!1},ae=fe({account:f().required("請輸入帳號").min(4,"帳號至少需輸入8個字").max(20,"帳號長度不得超過20個字").test("isAlphanumeric","帳號只能輸入英數字",o=>_.isAlphanumeric(o)),password:f().when("$isEditing",{is:!1,then:()=>f().required("請輸入密碼").min(8,"密碼至少需輸入8個字"),otherwise:()=>f()}),email:f().required("請輸入信箱").test("isEmail","請輸入正確的信箱格式",o=>_.isEmail(o)),phone:f().required("請輸入手機號碼").min(10,"請輸入10碼手機號碼").test("isMobilePhone","請輸入正確的手機號碼格式",o=>_.isMobilePhone(o))}),{handleSubmit:le,isSubmitting:v,resetForm:O}=be({validationSchema:ae,initialValues:{account:"",email:"",phone:"",password:""},validateOnMount:!1}),x=$("account"),D=$("password"),w=$("email"),h=$("phone"),te=le(async o=>{var e,a;try{const r={account:o.account.toLowerCase(),email:o.email,phone:o.phone,role:1};if(A.value){const g=await U.patch("/user/"+n.value.id,r);console.log("Admin updated:",g.data),c({text:"編輯管理者成功",snackbarProps:{color:"teal-darken-1"}})}else{r.password=o.password;const g=await Z.post("/user",r);console.log("New admin created:",g.data),c({text:"新增管理者成功",snackbarProps:{color:"teal-darken-1"}})}B(),d(!0)}catch(r){console.log(r),c({text:((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}}),I=i(10),C=i([{key:"createdAt",order:"desc"}]),P=i(1),M=i([]),oe=[{title:"帳號",align:"left",sortable:!1,key:"account"},{title:"email",align:"left",sortable:!0,key:"email"},{title:"手機",align:"left",sortable:!0,key:"phone"},{title:"操作",align:"left",sortable:!1,key:"action"}],F=i(!0),z=i(0),S=i(""),d=async o=>{var e,a,r,g;o&&(P.value=1),F.value=!0;try{const{data:p}=await U.get("/user/all",{params:{page:P.value,itemsPerPage:I.value,sortBy:((e=C.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=C.value[0])==null?void 0:a.order)||"desc",search:S.value,role:1}});M.value.splice(0,M.value.length,...p.result.data),z.value=p.result.adminTotal}catch(p){console.log(p),c({text:((g=(r=p==null?void 0:p.response)==null?void 0:r.data)==null?void 0:g.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}F.value=!1};d();const se=async()=>{var o,e;if(n.value.id)try{v.value=!0,await U.delete(`/user/${n.value.id}`),c({text:"刪除成功",snackbarProps:{color:"teal-darken-1"}}),B(),L(),d(!0)}catch(a){console.log(a),c({text:((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{v.value=!1}};return(o,e)=>(N(),ie(ue,null,[l(ye,null,{default:t(()=>[l(Ve,null,{default:t(()=>[l(q,{cols:"12"},{default:t(()=>[he]),_:1}),l(q,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:t(()=>[l(m,{class:"custom-btn",onClick:e[0]||(e[0]=a=>E(null))},{default:t(()=>[u(" 新增管理者 ")]),_:1}),l(T),l(b,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240",onClickAppend:e[2]||(e[2]=a=>d(!0)),onKeydown:e[3]||(e[3]=de(a=>d(!0),["enter"]))},null,8,["modelValue"])]),_:1}),l(q,{cols:"12"},{default:t(()=>[l(ke,{"items-per-page":I.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>I.value=a),e[7]||(e[7]=a=>d(!1))],"sort-by":C.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>C.value=a),e[8]||(e[8]=a=>d(!1))],page:P.value,"onUpdate:page":[e[6]||(e[6]=a=>P.value=a),e[9]||(e[9]=a=>d(!1))],"items-per-page-options":[10,20,50],items:M.value,headers:oe,loading:F.value,"items-length":z.value,search:S.value,hover:""},{top:t(()=>[]),"item.action":t(({item:a})=>[l(m,{icon:"mdi-pencil",variant:"plain",class:"edit-btn",onClick:r=>E(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(K,{modelValue:n.value.open,"onUpdate:modelValue":e[15]||(e[15]=a=>n.value.open=a),persistent:"",width:"440"},{default:t(()=>[l(xe,{disabled:s(v),onSubmit:pe(s(te),["prevent"])},{default:t(()=>[l(J,{class:"rounded-xl pa-4 pt-6"},{default:t(()=>[l(R,{style:{"font-size":"18px"}},{default:t(()=>[u(me(n.value.id?"管理者資料編輯":"新增管理者"),1)]),_:1}),l(j,{class:"mt-3 pa-3"},{default:t(()=>[l(b,{modelValue:s(x).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>s(x).value.value=a),"error-messages":s(x).errorMessage.value,label:"帳號",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),l(b,{modelValue:s(w).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>s(w).value.value=a),"error-messages":s(w).errorMessage.value,class:"mt-2",label:"email",type:"email",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:""},null,8,["modelValue","error-messages"]),l(b,{modelValue:s(h).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>s(h).value.value=a),"error-messages":s(h).errorMessage.value,class:"mt-2",label:"手機號碼",type:"text",variant:"outlined",density:"compact","min-length":"10",maxlength:"10",clearable:""},null,8,["modelValue","error-messages"]),n.value.id?Q("",!0):(N(),G(b,{key:0,modelValue:s(D).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>s(D).value.value=a),"error-messages":s(D).errorMessage.value,class:"mt-2",label:"密碼",variant:"outlined",density:"compact","min-length":"4",maxlength:"20",clearable:"",type:V.value?"text":"password","append-inner-icon":V.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[14]||(e[14]=a=>V.value=!V.value)},null,8,["modelValue","error-messages","type","append-inner-icon"]))]),_:1}),l(W,null,{default:t(()=>[n.value.id?(N(),G(m,{key:0,color:"red",loading:s(v),onClick:ee},{default:t(()=>[u(" 刪除 ")]),_:1},8,["loading"])):Q("",!0),l(T),l(m,{color:"red",loading:s(v),onClick:B},{default:t(()=>[u(" 取消 ")]),_:1},8,["loading"]),l(m,{color:"green",type:"submit",loading:s(v)},{default:t(()=>[u(" 送出 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),l(K,{modelValue:k.value.open,"onUpdate:modelValue":e[16]||(e[16]=a=>k.value.open=a),"max-width":"320"},{default:t(()=>[l(J,{class:"px-4 py-3"},{default:t(()=>[l(R,{class:"headline",style:{"font-size":"18px"}},{default:t(()=>[u(" 確認刪除 ")]),_:1}),l(j,{class:"mt-3 pa-4"},{default:t(()=>[u(" 您確定要刪除此管理者嗎？此操作無法撤銷。 ")]),_:1}),l(W,null,{default:t(()=>[l(T),l(m,{color:"green darken-1",text:"",onClick:L},{default:t(()=>[u(" 取消 ")]),_:1}),l(m,{color:"red darken-1",text:"",onClick:se},{default:t(()=>[u(" 刪除 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof X=="function"&&X(Y);const Oe=ne(Y,[["__scopeId","data-v-433eaa61"]]);export{Oe as default};
