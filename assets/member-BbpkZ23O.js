import{_ as F,l as M,u as T,i as U,r as v,n as z,a as L,o as d,q as g,w as a,h as V,e as l,d as e,s as x,v as N,x as b,V as S,m as j,g as m,y as $,b as k,t as p,z as h,A as q,f as E,F as H,B as R,C as G,D as J}from"./index-0ZMxAy8c.js";import{a as u,V as K}from"./VRow-BS5mGwpZ.js";import{V as O}from"./VTooltip-L3fbcPia.js";import{V as Q}from"./VDivider-CS-NJ3C9.js";import{V as W,a as X}from"./VList-DN2ppzag.js";import{V as Y}from"./VContainer-BzEAfHut.js";const Z={class:"d-flex justify-space-between"},ee={key:0},ae={__name:"member",setup(te){const{mdAndUp:C}=M(),{apiAuth:w}=J(),o=T(),f=U(),y=v(null),n=v(!1),_=v(!1),I=[{to:"/member/profile",text:"個人資料管理",icon:" mdi-account-cog"},{to:"/member/order",text:"訂單管理",icon:"mdi-list-box"},{to:"/member/enrollment",text:"報名紀錄",icon:"mdi-volleyball "},{to:"/member/post",text:"刊登場次",icon:"mdi-post"}],D=()=>{y.value.click()},B=r=>{const s=r.target.files[0];if(s){if(s.size>1024*1024){f({text:"檔案大小不能超過1MB",snackbarProps:{color:"red-lighten-1"}});return}P(s)}},P=async r=>{var s,i;if(r){n.value=!0;try{const t=new FormData;t.append("avatar",r);const{data:c}=await w.patch("/user/avatar",t,{headers:{"Content-Type":"multipart/form-data"}});f({text:c.message,snackbarProps:{color:"teal-darken-1"}}),await o.profile(),console.log(c)}catch(t){f({text:((i=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:i.message)||"上傳失敗",snackbarProps:{color:"red-darken-1"}})}finally{n.value=!1}}},A=async()=>{if(o.isLogin)try{await Promise.all([o.profile(),o.loadCart()])}catch(r){console.error("加載用戶數據失敗",r)}};return z(async()=>{await A()}),(r,s)=>{const i=L("router-view");return d(),g(Y,{class:"mt-8 mt-sm-16 mb-sm-8",style:{"max-width":"1220px","min-height":"80%"}},{default:a(()=>[V("div",Z,[l(C)?(d(),g(u,{key:0,id:"profile",class:"me-4 pa-0",cols:"3"},{default:a(()=>[e(u,null,{default:a(()=>[e(x,{class:"d-flex flex-column align-center profile-card pt-8 pb-4",elevation:"0"},{default:a(()=>[e(N,{src:l(o).avatar,class:"avatar",cover:""},{placeholder:a(()=>[e(K,{class:"fill-height ma-0",justify:"center",align:"center"},{default:a(()=>[e(b,{indeterminate:""})]),_:1})]),_:1},8,["src"]),e(O,{text:"檔案最大不超過1MB",location:"bottom","open-delay":50,"close-delay":50},{activator:a(({props:t})=>[e(S,j(t,{color:_.value?"primary":void 0,class:"camera-icon opacity-70",onClick:D,onMouseenter:s[0]||(s[0]=c=>_.value=!0),onMouseleave:s[1]||(s[1]=c=>_.value=!1)}),{default:a(()=>[m(" mdi-camera ")]),_:2},1040,["color"])]),_:1}),V("input",{ref_key:"fileInput",ref:y,type:"file",class:"d-none",accept:"image/*",onChange:B},null,544),e($,{style:{"font-size":"18px"}},{default:a(()=>[l(o).nickname?h("",!0):(d(),k("span",ee,p(l(o).name),1)),V("span",null,p(l(o).nickname),1)]),_:1}),e(q,null,{default:a(()=>[m(p(l(o).userId),1)]),_:1})]),_:1})]),_:1}),e(Q),e(u,{class:"pa-0"},{default:a(()=>[e(W,{width:"100%",class:"mt-4 mb-6"},{default:a(()=>[(d(),k(H,null,E(I,t=>e(X,{key:t.to,to:t.to,"prepend-icon":t.icon,class:"mb-4 opacity-90 ps-16",ripple:!1,active:!1,style:{"font-size":"14px"}},{default:a(()=>[m(p(t.text),1)]),_:2},1032,["to","prepend-icon"])),64))]),_:1})]),_:1})]),_:1})):h("",!0),e(u,{id:"content",cols:"12",md:"9",class:"pa-8"},{default:a(()=>[e(i)]),_:1})]),e(G,{modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=t=>n.value=t),persistent:"",width:"auto"},{default:a(()=>[e(x,{class:"rounded-lg"},{default:a(()=>[e(R,{class:"pa-12"},{default:a(()=>[m(" 頭像上傳中... "),e(b,{indeterminate:"",color:"primary",class:"ml-3"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},ce=F(ae,[["__scopeId","data-v-d344f1c4"]]);export{ce as default};
