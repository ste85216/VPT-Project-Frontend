import{_ as T,bh as E,u as Q,i as R,c as B,r as V,o as g,b as $,d as e,w as t,F as D,n as N,q as v,z as A,f as M,j as d,t as p,I as h,g as G,s as H,V as C,aK as J,aL as O,p as W,h as X}from"./index-U53tKImo.js";import{C as Y}from"./ConfirmDeleteDialog-EBPw2lX5.js";import{V as Z}from"./VContainer-TUYa85Ru.js";import{V as i,a as n}from"./VRow-iGTHm4ME.js";import{V as ee}from"./VTextarea-5uN9n__f.js";const x=m=>(W("data-v-edf906ed"),m=m(),X(),m),ae=x(()=>d("h2",{class:"mb-5"}," 購物車 ",-1)),te=x(()=>d("div",{class:"text-gray"}," 購物車內尚未加入商品 ",-1)),le={class:"card-text"},se={class:"card-text"},ne=x(()=>d("h4",{class:"note-title"}," 訂單備註 ",-1)),oe=x(()=>d("h4",{class:"total-price-title"}," 結帳金額 ",-1)),ce={class:"total-price"},ue={__name:"cart",setup(m){const _=E(),u=Q(),k=R(),f=B(()=>u.cart),r=V(!1),b=V(""),c=V({open:!1}),S=()=>{try{r.value=!0,u.loadCart()}catch(a){I(a)}finally{r.value=!1}},q=async a=>{(!a.quantity||a.quantity<1)&&(a.quantity=1),await y(a,a.quantity)},L=a=>{(isNaN(a.quantity)||a.quantity===null||a.quantity==="")&&(a.quantity=1)},w=async(a,s)=>{if(!u.isLogin){_.push("/login");return}if(s<1){c.value={open:!0,title:"您確認要移除嗎？",message:"",action:()=>y(a,0)};return}await y(a,s)},U=async(a,s=!0)=>{if(!u.isLogin){_.push("/login");return}const l=async()=>{await y(a,0)};s?c.value={open:!0,title:"您確認要移除嗎？",message:"",action:l}:await l()},K=async()=>{c.value.action&&await c.value.action(),j()},j=()=>{c.value.open=!1,c.value.action=null},y=async(a,s=null)=>{if(!u.isLogin){_.push("/login");return}const l=s!==null?s:a.quantity;try{await u.addCart(a.p_id._id,l,a.colors,a.sizes),await u.loadCart()}catch(o){I(o)}},I=a=>{var s,l;console.error(a),k({text:((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||"發生錯誤，請稍後再試",snackbarProps:{color:"red-lighten-1"}})},F=B(()=>f.value.reduce((a,s)=>a+s.p_id.price*s.quantity,0)),P=async()=>{r.value=!0;const a=await u.checkout(b.value);console.log(a),k({text:a.text,snackbarProps:{color:a.color}}),a.color==="teal-darken-1"&&(await u.loadCart(),_.push("/member/order")),r.value=!1};return S(),(a,s)=>(g(),$(D,null,[e(Z,{class:"px-4 px-lg-0 py-0 mt-10 mb-16",style:{"max-width":"1200px","min-height":"1200px"}},{default:t(()=>[ae,e(i,null,{default:t(()=>[e(n,{cols:"12",sm:"7",md:"8"},{default:t(()=>[f.value.length===0?(g(),N(v,{key:0,class:"mb-4 cart-card d-flex justify-center align-center"},{default:t(()=>[te]),_:1})):A("",!0),(g(!0),$(D,null,M(f.value,l=>(g(),N(v,{key:l._id,class:"mb-4 cart-card py-4 ps-4 pe-5"},{default:t(()=>[e(i,{"no-gutters":"",class:"d-flex justify-space-between"},{default:t(()=>[e(n,{cols:"4",md:"2",class:"d-flex align-center justify-center"},{default:t(()=>{var o,z;return[e(H,{src:(z=(o=l.p_id)==null?void 0:o.images)==null?void 0:z[0],elevation:"0",height:"80",width:"80"},null,8,["src"])]}),_:2},1024),e(n,{cols:"6",md:"9",class:"d-flex flex-column justify-center"},{default:t(()=>[e(i,{"no-gutters":""},{default:t(()=>[e(n,{cols:"12",md:"",class:"d-flex flex-column justify-center text-sm-center px-md-2"},{default:t(()=>[d("div",le,p(l.p_id.name??"未知商品")+" / "+p(l.p_id.price??0)+" 元 ",1)]),_:2},1024),e(n,{cols:"12",md:"",class:"d-flex align-center justify-sm-center ps-md-2"},{default:t(()=>[d("div",se,p(l.colors)+" / "+p(l.sizes),1)]),_:2},1024),e(n,{cols:"12",md:"4",class:"d-flex align-sm-center justify-sm-center"},{default:t(()=>[e(i,{"no-gutters":"",class:"d-flex align-sm-center justify-sm-center"},{default:t(()=>[e(n,{cols:"1",sm:"2",md:"4",class:"d-flex align-center justify-center me-3 me-md-0"},{default:t(()=>[e(h,{icon:"",size:"x-small",elevation:"0",class:"quantity-btn",onClick:o=>w(l,l.quantity-1)},{default:t(()=>[e(C,{icon:"mdi-minus",size:"small",class:"minus-btn"})]),_:2},1032,["onClick"])]),_:2},1024),e(n,{cols:"3",sm:"4",class:"d-flex align-center me-3 me-md-0"},{default:t(()=>[e(J,{modelValue:l.quantity,"onUpdate:modelValue":o=>l.quantity=o,modelModifiers:{number:!0},type:"number",min:"1",variant:"outlined",density:"compact",class:"quantity-input",onInput:o=>L(l),onBlur:o=>q(l),onKeypress:O(o=>q(l),["enter"])},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur","onKeypress"])]),_:2},1024),e(n,{cols:"1",sm:"2",md:"4",class:"d-flex align-center justify-center"},{default:t(()=>[e(h,{icon:"",size:"x-small",elevation:"0",class:"quantity-btn",onClick:o=>w(l,l.quantity+1)},{default:t(()=>[e(C,{icon:"mdi-plus",size:"small",class:"plus-btn"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(n,{cols:"1",md:"1",class:"d-flex align-center justify-center"},{default:t(()=>[e(h,{icon:"",class:"delete-btn",ripple:!1,variant:"plain",onClick:o=>U(l)},{default:t(()=>[e(C,{icon:"mdi-delete",color:"red-darken-3",class:"pb-2"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(n,{cols:"12",sm:"5",md:"4"},{default:t(()=>[e(v,{class:"pa-4 pb-0 cart-card mb-4",height:"160"},{default:t(()=>[e(i,null,{default:t(()=>[e(n,{cols:"12",class:"pb-0"},{default:t(()=>[ne]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(n,{class:"pt-4"},{default:t(()=>[e(ee,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=l=>b.value=l),rows:"2",variant:"outlined","auto-grow":"","base-color":"#666","hide-details":"","no-resize":"","max-rows":"2",disabled:r.value||f.value.length===0},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(v,{class:"pa-4 pb-0 cart-card",height:"150"},{default:t(()=>[e(i,{class:"d-flex flex-column h-100"},{default:t(()=>[e(n,{class:"d-flex justify-space-between"},{default:t(()=>[oe,d("div",ce," $"+p(F.value),1)]),_:1}),e(n,{class:"pb-0"},{default:t(()=>[e(h,{color:"primary",class:"checkout-btn",disabled:r.value||f.value.length===0,onClick:P},{default:t(()=>[G(" 結帳 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Y,{modelValue:c.value.open,"onUpdate:modelValue":s[1]||(s[1]=l=>c.value.open=l),title:c.value.title,message:c.value.message,"cancel-size":"small","confirm-size":"small",onConfirm:K,onCancel:j},null,8,["modelValue","title","message"])],64))}},me=T(ue,[["__scopeId","data-v-edf906ed"]]);export{me as default};
