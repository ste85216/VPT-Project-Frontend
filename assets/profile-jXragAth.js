import{_ as X,k as Z,u as ee,i as ae,r as I,l as le,o as w,b as te,d as e,e as t,n as q,w as a,aM as A,z as E,B as se,F as oe,g as r,aK as i,ax as T,I as N,s as re,v as j,V as ne,m as ue,j as c,t as de,q as ie,A as me,p as ce,h as pe,C as fe}from"./index-DDIO4Uho.js";import{c as ve,a as _,u as ye,b}from"./vee-validate.esm-CUoRnCOJ.js";import{v as D}from"./index-DcBOdE6S.js";import{b as O}from"./route-block-B_A1xBdJ.js";import{V as H}from"./VForm-CAiRdGM1.js";import{V as ge}from"./VDivider-Cgr5dsOi.js";import{a as o,V as d}from"./VRow-2kM51MOT.js";import{V as Ve}from"./VTooltip-EHqYjPUg.js";import"./_commonjsHelpers-Cpj98o6Y.js";const p=k=>(ce("data-v-87863307"),k=k(),pe(),k),_e=p(()=>c("h3",{class:"opacity-90 mb-4"}," 個人資料管理 ",-1)),be=p(()=>c("span",{style:{color:"#d9534f"}},"*",-1)),xe=p(()=>c("span",{style:{color:"#d9534f"}},"*",-1)),ke=p(()=>c("span",{style:{color:"#d9534f"}},"*",-1)),he=p(()=>c("span",{style:{color:"#d9534f"}},"*",-1)),Se=p(()=>c("span",{style:{color:"#d9534f"}},"*",-1)),Me=p(()=>c("span",{style:{color:"#d9534f"}},"*",-1)),K={__name:"profile",setup(k){const{mdAndUp:C}=Z(),{apiAuth:R}=fe(),m=ee(),x=ae(),F=I(null),h=I(!1),U=I(!1),Y=()=>{F.value.click()},G=n=>{const l=n.target.files[0];if(l){if(l.size>1024*1024){x({text:"檔案大小不能超過1MB",snackbarProps:{color:"red-lighten-1"}});return}J(l)}},J=async n=>{var l,s;if(n){h.value=!0;try{const u=new FormData;u.append("avatar",n);const{data:P}=await R.patch("/user/avatar",u,{headers:{"Content-Type":"multipart/form-data"}});x({text:P.message,snackbarProps:{color:"teal-darken-1"}}),await m.profile(),console.log(P)}catch(u){x({text:((s=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:s.message)||"上傳失敗",snackbarProps:{color:"red-darken-1"}})}finally{h.value=!1}}},B=n=>{const l=new Date(n),s=l.getFullYear(),u=String(l.getMonth()+1).padStart(2,"0"),P=String(l.getDate()).padStart(2,"0");return`${s}-${u}-${P}`},L=n=>new Date(n).toISOString(),Q=ve({name:_().required("請輸入姓名"),nickname:_(),birthday:_().required("請輸入生日").test("isDate","請輸入正確的日期格式",n=>D.isDate(n)),phone:_().required("請輸入手機號碼").min(10,"請輸入10碼手機號碼").test("isMobilePhone","請輸入正確的手機號碼格式",n=>D.isMobilePhone(n)),email:_().required("請輸入信箱").test("isEmail","請輸入正確的信箱格式",n=>D.isEmail(n)),address:_()}),{handleSubmit:W,setValues:z,isSubmitting:S}=ye({validationSchema:Q,initialValues:{name:"",nickname:"",birthday:"",phone:"",email:"",address:""}}),f=b("name"),M=b("nickname"),v=b("birthday"),y=b("phone"),g=b("email"),V=b("address");le(async()=>{await m.profile(),z({name:m.name,nickname:m.nickname,birthday:B(m.birthday),phone:m.phone,email:m.email,address:m.address})});const $=W(async n=>{var l,s;try{const u=await m.updateProfile({...n,birthday:L(n.birthday)});z({...u,birthday:B(u.birthday)}),x({text:"資料更新成功",snackbarProps:{color:"teal-darken-1"}})}catch(u){x({text:((s=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}});return(n,l)=>(w(),te(oe,null,[_e,e(ge,{class:"mb-8"}),t(C)?(w(),q(H,{key:0,disabled:t(S),onSubmit:A(t($),["prevent"])},{default:a(()=>[e(d,{style:{"font-size":"14px"},class:"text-blue-grey-darken-2"},{default:a(()=>[e(o,{class:"px-4 py-0",cols:"4"},{default:a(()=>[r(" 姓名 "),be,r(" : ")]),_:1}),e(o,{class:"px-4 py-0"},{default:a(()=>[r(" 暱稱 : ")]),_:1}),e(o,{class:"px-4 py-0"},{default:a(()=>[r(" 生日 : ")]),_:1})]),_:1}),e(d,{class:"mt-4"},{default:a(()=>[e(o,{class:"pt-1"},{default:a(()=>[e(i,{modelValue:t(f).value.value,"onUpdate:modelValue":l[0]||(l[0]=s=>t(f).value.value=s),"error-messages":t(f).errorMessage.value,density:"compact",variant:"outlined",clearable:""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{class:"pt-1"},{default:a(()=>[e(i,{modelValue:t(M).value.value,"onUpdate:modelValue":l[1]||(l[1]=s=>t(M).value.value=s),density:"compact",variant:"outlined","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(o,{class:"pt-1"},{default:a(()=>[e(i,{modelValue:t(v).value.value,"onUpdate:modelValue":l[2]||(l[2]=s=>t(v).value.value=s),"error-messages":t(v).errorMessage.value,type:"date",density:"compact",variant:"outlined","hide-details":"",clearable:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(d,{class:"mt-4 text-blue-grey-darken-2",style:{"font-size":"14px"}},{default:a(()=>[e(o,{class:"px-4 py-0",cols:"4"},{default:a(()=>[r(" 手機號碼 "),xe,r(" : ")]),_:1}),e(o,{class:"px-4 py-0",cols:"4"},{default:a(()=>[r(" Email "),ke,r(" : ")]),_:1})]),_:1}),e(d,null,{default:a(()=>[e(o,{cols:"4"},{default:a(()=>[e(i,{modelValue:t(y).value.value,"onUpdate:modelValue":l[3]||(l[3]=s=>t(y).value.value=s),"error-messages":t(y).errorMessage.value,density:"compact",variant:"outlined",maxlength:"10",clearable:""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"4"},{default:a(()=>[e(i,{modelValue:t(g).value.value,"onUpdate:modelValue":l[4]||(l[4]=s=>t(g).value.value=s),"error-messages":t(g).errorMessage.value,density:"compact",variant:"outlined",clearable:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(d,{class:"mt-4 text-blue-grey-darken-2",style:{"font-size":"14px"}},{default:a(()=>[e(o,{class:"px-4 py-0"},{default:a(()=>[r(" 地址 : ")]),_:1})]),_:1}),e(d,null,{default:a(()=>[e(o,{cols:"8"},{default:a(()=>[e(i,{modelValue:t(V).value.value,"onUpdate:modelValue":l[5]||(l[5]=s=>t(V).value.value=s),"error-messages":t(V).errorMessage.value,density:"compact",variant:"outlined","hide-details":"",clearable:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(d,{class:"px-4 py-10"},{default:a(()=>[e(T),e(N,{elevation:"0",color:"teal-darken-1",variant:"outlined",type:"submit",loading:t(S)},{default:a(()=>[r(" 儲存 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])):E("",!0),t(C)?E("",!0):(w(),q(H,{key:1,id:"profile-form-sm",disabled:t(S),onSubmit:A(t($),["prevent"])},{default:a(()=>[e(d,{style:{"font-size":"14px"},class:"text-blue-grey-darken-2"},{default:a(()=>[e(o,{cols:"12"},{default:a(()=>[e(d,{class:"d-flex justify-center align-center"},{default:a(()=>[e(o,{cols:"4",class:"position-relative"},{default:a(()=>[e(re,{src:t(m).avatar,class:"avatar","aspect-ratio":1,cover:""},{placeholder:a(()=>[e(d,{class:"fill-height ma-0",justify:"center",align:"center"},{default:a(()=>[e(j,{indeterminate:""})]),_:1})]),_:1},8,["src"]),e(Ve,{text:"檔案最大不超過1MB",location:"bottom","open-delay":50,"close-delay":50},{activator:a(({props:s})=>[e(ne,ue(s,{color:U.value?"primary":void 0,class:"camera-icon opacity-70",onClick:Y,onMouseenter:l[6]||(l[6]=u=>U.value=!0),onMouseleave:l[7]||(l[7]=u=>U.value=!1)}),{default:a(()=>[r(" mdi-camera ")]),_:2},1040,["color"])]),_:1}),c("input",{ref_key:"fileInput",ref:F,type:"file",class:"d-none",accept:"image/*",onChange:G},null,544)]),_:1}),e(o,{cols:"12",class:"text-center text-teal-darken-3 userId"},{default:a(()=>[r(de(t(m).userId),1)]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",class:"px-4 py-0 mt-4"},{default:a(()=>[e(d,null,{default:a(()=>[e(o,{cols:"4"},{default:a(()=>[r(" 姓名 "),he,r(" : ")]),_:1}),e(o,null,{default:a(()=>[e(i,{modelValue:t(f).value.value,"onUpdate:modelValue":l[8]||(l[8]=s=>t(f).value.value=s),"error-messages":t(f).errorMessage.value,density:"compact",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(o,{cols:"12",class:"px-4 py-0"},{default:a(()=>[e(d,null,{default:a(()=>[e(o,{cols:"4"},{default:a(()=>[r(" 暱稱 : ")]),_:1}),e(o,null,{default:a(()=>[e(i,{modelValue:t(M).value.value,"onUpdate:modelValue":l[9]||(l[9]=s=>t(M).value.value=s),density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(o,{class:"px-4 py-0",cols:"12"},{default:a(()=>[e(d,null,{default:a(()=>[e(o,{cols:"4"},{default:a(()=>[r(" 生日 : ")]),_:1}),e(o,null,{default:a(()=>[e(i,{modelValue:t(v).value.value,"onUpdate:modelValue":l[10]||(l[10]=s=>t(v).value.value=s),"error-messages":t(v).errorMessage.value,type:"date",density:"compact",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(o,{class:"px-4 py-0",cols:"12"},{default:a(()=>[e(d,null,{default:a(()=>[e(o,{cols:"4"},{default:a(()=>[r(" 手機號碼 "),Se,r(" : ")]),_:1}),e(o,null,{default:a(()=>[e(i,{modelValue:t(y).value.value,"onUpdate:modelValue":l[11]||(l[11]=s=>t(y).value.value=s),"error-messages":t(y).errorMessage.value,density:"compact",variant:"outlined",maxlength:"10"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(o,{class:"px-4 py-0",cols:"12"},{default:a(()=>[e(d,null,{default:a(()=>[e(o,{cols:"4"},{default:a(()=>[r(" Email "),Me,r(" : ")]),_:1}),e(o,null,{default:a(()=>[e(i,{modelValue:t(g).value.value,"onUpdate:modelValue":l[12]||(l[12]=s=>t(g).value.value=s),"error-messages":t(g).errorMessage.value,density:"compact",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(o,{class:"px-4 py-0",cols:"12"},{default:a(()=>[e(d,null,{default:a(()=>[e(o,{cols:"4"},{default:a(()=>[r(" 地址 : ")]),_:1}),e(o,null,{default:a(()=>[e(i,{modelValue:t(V).value.value,"onUpdate:modelValue":l[13]||(l[13]=s=>t(V).value.value=s),"error-messages":t(V).errorMessage.value,density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{class:"px-4 py-10"},{default:a(()=>[e(T),e(N,{elevation:"0",color:"teal-darken-1",variant:"outlined",type:"submit",size:"small",loading:t(S)},{default:a(()=>[r(" 儲存 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])),e(se,{modelValue:h.value,"onUpdate:modelValue":l[14]||(l[14]=s=>h.value=s),persistent:"",width:"auto"},{default:a(()=>[e(ie,{class:"rounded-lg"},{default:a(()=>[e(me,{class:"pa-12"},{default:a(()=>[r(" 頭像上傳中... "),e(j,{indeterminate:"",color:"primary",class:"ml-3"})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};typeof O=="function"&&O(K);const Ae=X(K,[["__scopeId","data-v-87863307"]]);export{Ae as default};
