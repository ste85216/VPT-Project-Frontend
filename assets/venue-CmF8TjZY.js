import{_ as fe,i as be,r as i,a as Ve,n as M,w as t,C as ye,o as b,d as l,I as f,g as m,ax as T,aK as k,aL as ke,j as K,b as R,f as Q,F as W,e as s,aM as xe,q as X,x as Y,t as he,A as Z,z as ee,aN as ae,B as le,s as te,V as we,v as Ce,p as _e,h as Ie}from"./index-S5hIqWP-.js";import{c as Se,a as h,u as Ue,b as w}from"./vee-validate.esm-Ju8nV_kP.js";import{b as oe}from"./route-block-B_A1xBdJ.js";import{V as Pe}from"./VContainer-CgLe3VrY.js";import{a as z,V as j}from"./VRow-DL2f0UFX.js";import{V as Le}from"./VDataTableServer--QP64YjK.js";import{V as Ae}from"./VForm-K9QnodQ7.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-BrzquYXs.js";import"./VPagination-DVWEKF4y.js";import"./VSelect-CIf9AuDG.js";import"./VList-CRA42THW.js";import"./VDivider-CVfeQEYu.js";import"./VCheckboxBtn-BzKpTTXK.js";import"./VChip-D0QSG7hg.js";import"./filter-CV7uvhXb.js";const se=C=>(_e("data-v-a7ed7bac"),C=C(),Ie(),C),Be=se(()=>K("h2",{class:"text-center"}," 球場資訊管理 ",-1)),$e={class:"images-container"},Fe={key:0,class:"mb-5 px-2 py-1",style:{border:"1px solid #ababab","border-radius":"4px"}},Me=se(()=>K("div",{style:{"font-size":"14px","font-weight":"400",color:"#333"}}," 現有圖片： ",-1)),ne={__name:"venue",setup(C){const{apiAuth:_}=ye(),x=be(),O=i(null),n=i({open:!1,id:""}),I=i({open:!1}),v=i([]),H=o=>{o?(n.value.id=o._id,S.value.value=o.name,U.value.value=o.time,P.value.value=o.address,L.value.value=o.phone,A.value.value=o.mapLink,v.value=o.images.map(a=>({url:a,isExisting:!0})),c.value=[],V.value=[]):(n.value.id="",c.value=[],V.value=[],v.value=[]),n.value.open=!0},D=()=>{n.value.open=!1,de(),O.value.deleteFileRecord(),c.value=[],V.value=[],v.value=[]},re=()=>{I.value.open=!0},J=()=>{I.value.open=!1},ie=Se({name:h().required("球場名稱必填"),time:h().required("營業時間必填"),address:h().required("球場地址必填"),phone:h().required("球場電話必填"),mapLink:h().required("球場連結必填")}),{handleSubmit:ue,isSubmitting:d,resetForm:de}=Ue({validationSchema:ie,initialValues:{name:"",time:"",address:"",phone:"",mapLink:""}}),S=w("name"),U=w("time"),P=w("address"),L=w("phone"),A=w("mapLink"),c=i([]),V=i([]),pe=ue(async o=>{var a,u;if(console.log("Submit button clicked"),d.value=!1,d.value){console.log("Already submitting");return}if(!c.value.some(e=>e.error)&&!(n.value.id.length===0&&c.value.length<1&&v.value.length===0)){d.value=!0;try{const e=new FormData;e.append("name",o.name),e.append("time",o.time),e.append("address",o.address),e.append("phone",o.phone),e.append("mapLink",o.mapLink);const p=v.value.map(y=>y.url);e.append("existingImages",JSON.stringify(p)),c.value.forEach(y=>{y.file&&e.append("newImages",y.file)});for(const[y,ge]of e.entries())console.log(y,ge);let r;n.value.id===""?(console.log("Creating new venue"),r=await _.post("/venue",e)):(console.log("Updating existing venue"),r=await _.patch("/venue/"+n.value.id,e)),console.log("API response:",r.data),x({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"teal-darken-1"}}),D(),g(!0)}catch(e){console.log("Error:",e),x({text:((u=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{d.value=!1,c.value=[],V.value=[],v.value=[]}}}),me=o=>{v.value.splice(o,1)},q=i(10),B=i([{key:"createdAt",order:"desc"}]),$=i(1),N=i([]),ve=[{title:"圖片",align:"left",sortable:!1,key:"images",width:"180px"},{title:"名稱",align:"left",sortable:!0,key:"name",width:"150px"},{title:"營業時間",align:"left",sortable:!0,key:"time",width:"180px"},{title:"地址",align:"left",sortable:!0,key:"address",width:"220px"},{title:"電話",align:"left",sortable:!0,key:"phone",width:"200px"},{title:"操作",align:"left",sortable:!1,key:"action",width:"120px"}],E=i(!0),G=i(0),F=i(""),g=async o=>{var a,u,e,p;o&&($.value=1),E.value=!0;try{const{data:r}=await _.get("/venue/all",{params:{page:$.value,itemsPerPage:q.value,sortBy:((a=B.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((u=B.value[0])==null?void 0:u.order)||"desc",search:F.value}});N.value.splice(0,N.value.length,...r.result.data),G.value=r.result.total}catch(r){x({text:((p=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:p.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}E.value=!1};g();const ce=async()=>{var o,a;if(n.value.id)try{d.value=!0,await _.delete(`/venue/${n.value.id}`),x({text:"刪除成功",snackbarProps:{color:"teal-darken-1"}}),D(),J(),g(!0)}catch(u){x({text:((a=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red-lighten-1"}})}finally{d.value=!1}};return(o,a)=>{const u=Ve("vue-file-agent");return b(),M(Pe,null,{default:t(()=>[l(j,null,{default:t(()=>[l(z,{cols:"12"},{default:t(()=>[Be]),_:1}),l(z,{cols:"12",class:"d-flex pa-0 ps-4 pe-4 mt-5"},{default:t(()=>[l(f,{class:"custom-btn",onClick:a[0]||(a[0]=e=>H(null))},{default:t(()=>[m(" 新增球場資訊 ")]),_:1}),l(T),l(k,{modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=e=>F.value=e),label:"搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","max-width":"240",clearable:"",onClickAppend:a[2]||(a[2]=e=>g(!0)),onKeydown:a[3]||(a[3]=ke(e=>g(!0),["enter"]))},null,8,["modelValue"])]),_:1}),l(z,{cols:"12"},{default:t(()=>[l(Le,{"items-per-page":q.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=e=>q.value=e),a[7]||(a[7]=e=>g(!1))],"sort-by":B.value,"onUpdate:sortBy":[a[5]||(a[5]=e=>B.value=e),a[8]||(a[8]=e=>g(!1))],page:$.value,"onUpdate:page":[a[6]||(a[6]=e=>$.value=e),a[9]||(a[9]=e=>g(!1))],"items-per-page-options":[10,20,50],items:N.value,headers:ve,loading:E.value,"items-length":G.value,search:F.value,hover:""},{top:t(()=>[]),"item.images":t(({value:e})=>[K("div",$e,[(b(!0),R(W,null,Q(e,(p,r)=>(b(),M(te,{key:r,src:p,class:"me-2",height:"50"},null,8,["src"]))),128))])]),"item.action":t(({item:e})=>[l(f,{icon:"mdi-pencil",variant:"plain",class:"edit-btn",onClick:p=>H(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),l(le,{modelValue:n.value.open,"onUpdate:modelValue":a[17]||(a[17]=e=>n.value.open=e),persistent:"",width:"500"},{default:t(()=>[l(Ae,{disabled:s(d),onSubmit:xe(s(pe),["prevent"])},{default:t(()=>[l(X,{class:"rounded-xl pa-4 pt-6"},{default:t(()=>[l(Y,{style:{"font-size":"18px"}},{default:t(()=>[m(he(n.value.id?"編輯球場資訊":"新增球場資訊"),1)]),_:1}),l(Z,{class:"mt-3 pa-3"},{default:t(()=>[l(k,{modelValue:s(S).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>s(S).value.value=e),label:"球場名稱",variant:"outlined",density:"compact","error-messages":s(S).errorMessage.value},null,8,["modelValue","error-messages"]),l(k,{modelValue:s(U).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>s(U).value.value=e),label:"營業時間",variant:"outlined",density:"compact","error-messages":s(U).errorMessage.value},null,8,["modelValue","error-messages"]),l(k,{modelValue:s(P).value.value,"onUpdate:modelValue":a[12]||(a[12]=e=>s(P).value.value=e),label:"地址",variant:"outlined",density:"compact","error-messages":s(P).errorMessage.value},null,8,["modelValue","error-messages"]),l(k,{modelValue:s(L).value.value,"onUpdate:modelValue":a[13]||(a[13]=e=>s(L).value.value=e),label:"電話",variant:"outlined",density:"compact","error-messages":s(L).errorMessage.value},null,8,["modelValue","error-messages"]),l(k,{modelValue:s(A).value.value,"onUpdate:modelValue":a[14]||(a[14]=e=>s(A).value.value=e),label:"連結",variant:"outlined",density:"compact","error-messages":s(A).errorMessage.value},null,8,["modelValue","error-messages"]),v.value.length>0?(b(),R("div",Fe,[Me,l(j,null,{default:t(()=>[(b(!0),R(W,null,Q(v.value,(e,p)=>(b(),M(z,{key:p,cols:"3",class:"position-relative"},{default:t(()=>[l(f,{icon:"",size:"x-small",elevation:"8",height:"24",width:"24",style:{position:"absolute",right:"0",top:"0","z-index":"1"},onClick:r=>me(p)},{default:t(()=>[l(we,{size:"small",color:"error"},{default:t(()=>[m(" mdi-close ")]),_:1})]),_:2},1032,["onClick"]),l(te,{src:e.url,"aspect-ratio":"1",cover:""},{placeholder:t(()=>[l(j,{class:"fill-height ma-0",justify:"center"},{default:t(()=>[l(Ce,{indeterminate:"",color:"grey lighten-5"})]),_:1})]),_:2},1032,["src"])]),_:2},1024))),128))]),_:1})])):ee("",!0),l(u,{ref_key:"fileAgent",ref:O,modelValue:c.value,"onUpdate:modelValue":a[15]||(a[15]=e=>c.value=e),"raw-model-value":V.value,"onUpdate:rawModelValue":a[16]||(a[16]=e=>V.value=e),accept:"image/jpeg,image/png",multiple:"",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"}},null,8,["modelValue","raw-model-value"])]),_:1}),l(ae,null,{default:t(()=>[n.value.id?(b(),M(f,{key:0,color:"red",loading:s(d),onClick:re},{default:t(()=>[m(" 刪除 ")]),_:1},8,["loading"])):ee("",!0),l(T),l(f,{color:"red",loading:s(d),onClick:D},{default:t(()=>[m(" 取消 ")]),_:1},8,["loading"]),l(f,{color:"green",type:"submit",loading:s(d)},{default:t(()=>[m(" 送出 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),l(le,{modelValue:I.value.open,"onUpdate:modelValue":a[18]||(a[18]=e=>I.value.open=e),"max-width":"320"},{default:t(()=>[l(X,null,{default:t(()=>[l(Y,{class:"headline",style:{"font-size":"18px"}},{default:t(()=>[m(" 確認刪除 ")]),_:1}),l(Z,{class:"mt-3 pa-4"},{default:t(()=>[m(" 您確定要刪除此球場資訊嗎？此操作無法撤銷。 ")]),_:1}),l(ae,null,{default:t(()=>[l(T),l(f,{color:"green darken-1",text:"",onClick:J},{default:t(()=>[m(" 取消 ")]),_:1}),l(f,{color:"red darken-1",text:"",onClick:ce},{default:t(()=>[m(" 刪除 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};typeof oe=="function"&&oe(ne);const Ye=fe(ne,[["__scopeId","data-v-a7ed7bac"]]);export{Ye as default};
