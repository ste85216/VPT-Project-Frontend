import{_ as P,k as A,u as F,i as M,r as f,l as T,a as U,o as v,n as g,w as a,j as y,e as d,d as e,q as x,s as z,v as b,V as L,m as N,g as l,x as S,t as _,y as j,b as $,f as q,F as E,z as H,A as R,B as G,C as J}from"./index-BAtAlQhu.js";import{a as p,V as K}from"./VRow-CxH-Af6O.js";import{V as O}from"./VTooltip-B1ic1Ygi.js";import{V as Q}from"./VDivider-BB4yNPuY.js";import{V as W,a as X}from"./VList-DBMjGRSS.js";import{V as Y}from"./VContainer-CQU6x_15.js";const Z={class:"d-flex justify-space-between"},ee={__name:"member",setup(ae){const{mdAndUp:C}=A(),{apiAuth:k}=J(),o=F(),m=M(),V=f(null),n=f(!1),u=f(!1),h=[{to:"/member/profile",text:"個人資料管理",icon:" mdi-account-cog"},{to:"/member/order",text:"訂單管理",icon:"mdi-list-box"},{to:"/member/enrollment",text:"報名紀錄",icon:"mdi-volleyball "},{to:"/member/post",text:"刊登場次",icon:"mdi-post"}],w=()=>{V.value.click()},I=r=>{const s=r.target.files[0];if(s){if(s.size>1024*1024){m({text:"檔案大小不能超過1MB",snackbarProps:{color:"red-lighten-1"}});return}B(s)}},B=async r=>{var s,i;if(r){n.value=!0;try{const t=new FormData;t.append("avatar",r);const{data:c}=await k.patch("/user/avatar",t,{headers:{"Content-Type":"multipart/form-data"}});m({text:c.message,snackbarProps:{color:"teal-darken-1"}}),await o.profile(),console.log(c)}catch(t){m({text:((i=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:i.message)||"上傳失敗",snackbarProps:{color:"red-darken-1"}})}finally{n.value=!1}}},D=async()=>{if(o.isLogin)try{await Promise.all([o.profile(),o.loadCart()])}catch(r){console.error("加載用戶數據失敗",r)}};return T(async()=>{await D()}),(r,s)=>{const i=U("router-view");return v(),g(Y,{class:"mt-8 mt-sm-16",style:{"max-width":"1220px",height:"75%"}},{default:a(()=>[y("div",Z,[d(C)?(v(),g(p,{key:0,id:"profile",class:"me-4 pa-0",cols:"3"},{default:a(()=>[e(p,null,{default:a(()=>[e(x,{class:"d-flex flex-column align-center profile-card pt-8 pb-4",elevation:"0"},{default:a(()=>[e(z,{src:d(o).avatar,class:"avatar",cover:""},{placeholder:a(()=>[e(K,{class:"fill-height ma-0",justify:"center",align:"center"},{default:a(()=>[e(b,{indeterminate:""})]),_:1})]),_:1},8,["src"]),e(O,{text:"檔案最大不超過1MB",location:"bottom","open-delay":50,"close-delay":50},{activator:a(({props:t})=>[e(L,N(t,{color:u.value?"primary":void 0,class:"camera-icon opacity-70",onClick:w,onMouseenter:s[0]||(s[0]=c=>u.value=!0),onMouseleave:s[1]||(s[1]=c=>u.value=!1)}),{default:a(()=>[l(" mdi-camera ")]),_:2},1040,["color"])]),_:1}),y("input",{ref_key:"fileInput",ref:V,type:"file",class:"d-none",accept:"image/*",onChange:I},null,544),e(S,{style:{"font-size":"18px"}},{default:a(()=>[l(_(d(o).name),1)]),_:1}),e(j,null,{default:a(()=>[l(_(d(o).userId),1)]),_:1})]),_:1})]),_:1}),e(Q),e(p,{class:"pa-0"},{default:a(()=>[e(W,{width:"100%",class:"mt-4 mb-6"},{default:a(()=>[(v(),$(E,null,q(h,t=>e(X,{key:t.to,to:t.to,"prepend-icon":t.icon,class:"mb-4 opacity-90 ps-16",ripple:!1,active:!1,style:{"font-size":"14px"}},{default:a(()=>[l(_(t.text),1)]),_:2},1032,["to","prepend-icon"])),64))]),_:1})]),_:1})]),_:1})):H("",!0),e(p,{id:"content",cols:"12",md:"9",class:"pa-8"},{default:a(()=>[e(i)]),_:1})]),e(G,{modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=t=>n.value=t),persistent:"",width:"auto"},{default:a(()=>[e(x,{class:"rounded-lg"},{default:a(()=>[e(R,{class:"pa-12"},{default:a(()=>[l(" 頭像上傳中... "),e(b,{indeterminate:"",color:"primary",class:"ml-3"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},ie=P(ee,[["__scopeId","data-v-a099d50d"]]);export{ie as default};
